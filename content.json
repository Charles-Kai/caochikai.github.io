[{"title":"é‡æ–°éƒ¨ç½²Hexo","date":"2019-12-15T08:32:00.000Z","path":"2019/12/15/hello-world/","text":"æµ‹è¯•","tags":[]},{"title":"æœåŠ¡å™¨é…ç½®è®°å½•","date":"2019-09-27T16:48:12.000Z","path":"2019/09/28/æœåŠ¡å™¨é…ç½®è®°å½•/","text":"æœåŠ¡å™¨é…ç½®è®°å½•ä¸€ã€èƒŒæ™¯ çœŸå®ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼šnginxã€tomcaté…ç½®httpsè¯ä¹¦ äºŒã€nginxå®‰è£…è¿‡ç¨‹ï¼š123456789101112131415//ä¸€é”®å®‰è£…ä¸Šé¢å››ä¸ªä¾èµ–yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel//ä¸‹è½½taråŒ…wget http://nginx.org/download/nginx-1.16.1.tar.gztar xzf nginx-1.16.1.tar.gz -C /usr/local//æ–‡ä»¶åæ”¹nginx-1.16.1æˆnginx//è¿›å…¥nginxç›®å½•cd /usr/local/nginx//å…³è”ç¼–è¯‘httpsæ¨¡å— ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module//æ‰§è¡Œmakeå‘½ä»¤ç¼–è¯‘æºç make//æ‰§è¡Œmake installå®‰è£…å¯æ‰§è¡Œbinmake install//æ–°å»ºlogsï¼ˆæ—¥å¿—ï¼‰å’Œsslï¼ˆè¯ä¹¦ï¼‰æ–‡ä»¶å¤¹ httpsæµè§ˆå™¨å½±å“â€”â€”æ··åˆå†…å®¹ è§£å†³Nginxåä»£Tomcat Httpã€Httpsæ··åˆå†…å®¹æŠ¥é”™ï¼Œæµè§ˆå™¨è®¤ä¸ºhttpsè¯·æ±‚ä¸­èµ„æºæ˜¯httpçš„cssã€jså’Œå›¾ç‰‡éƒ½æ— æ³•æ­£å¸¸åŠ è½½ï¼Œé€ æˆæ— æ³•åŒåè®®å…¼å®¹ï¼ 12æµè§ˆå™¨è®¿é—®åå¼€å‘è€…æ¨¡å¼çœ‹åˆ°çš„æŠ¥é”™ä¿¡æ¯ï¼šMixed Content: The page at &#39;https:&#x2F;&#x2F;dashboard.domain.com&#x2F;wire&#39; was loaded over HTTPS, but requested an insecure stylesheet &#39;http:&#x2F;&#x2F;dashboard.domain.com&#x2F;static&#x2F;css&#x2F;flickity.css&#39;. This request has been blocked; the content must be served over HTTPS. nginxè§£å†³é…ç½®12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061user www;worker_processes auto;error_log /var/log/nginx/error.log;pid /run/nginx.pid;events &#123; worker_connections 51200; multi_accept on;&#125;http &#123; include mime.types; default_type application/octet-stream; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; #gzip on; gzip on; server &#123; listen 80; listen 443 ssl; server_name chinaffxz.com; #charset koi8-r; ssl_certificate /usr/local/nginx/ssl/2879444_chinagzhxy.com.pem; ssl_certificate_key /usr/local/nginx/ssl/2879444_chinagzhxy.com.key; location / &#123; proxy_pass http://127.0.0.1:xxxx/; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #è§£å†³å…¼å®¹é…ç½®è¦ç‚¹ proxy_set_header X-Forwarded-Proto $scheme; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;&#125; Tomcaté…ç½®1234567891011121314151617181920212223242526272829303132&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;Server port=\"8006\" shutdown=\"SHUTDOWN\"&gt; &lt;Listener className=\"org.apache.catalina.core.JreMemoryLeakPreventionListener\" /&gt; &lt;Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.AprLifecycleListener\" /&gt; &lt;GlobalNamingResources&gt; &lt;Resource name=\"UserDatabase\" auth=\"Container\" type=\"org.apache.catalina.UserDatabase\" description=\"User database that can be updated and saved\" factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" pathname=\"conf/tomcat-users.xml\" /&gt; &lt;/GlobalNamingResources&gt; &lt;Service name=\"Catalina\"&gt; &lt;Connector port=\"38080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" maxThreads=\"1000\" minSpareThreads=\"20\" acceptCount=\"1000\" maxHttpHeaderSize=\"65536\" debug=\"0\" disableUploadTimeout=\"true\" useBodyEncodingForURI=\"true\" enableLookups=\"false\" URIEncoding=\"UTF-8\" /&gt; &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt; &lt;!-- è§£å†³å…¼å®¹è¦ç‚¹--&gt; &lt;Valve className=\"org.apache.catalina.valves.RemoteIpValve\" remoteIpHeader=\"X-Forwarded-For\" protocolHeader=\"X-Forwarded-Proto\" protocolHeaderHttpsValue=\"https\"/&gt; &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt; &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\" /&gt; &lt;/Realm&gt; &lt;Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt; &lt;!-- Access log processes all example. Documentation at: /docs/config/valve.html Note: The pattern used is equivalent to using pattern=\"common\" --&gt; &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log\" suffix=\".txt\" pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt; &lt;Context path=\"\" docBase =\"mall\" debug=\"0\" reloadable=\"true\" crossContext=\"false\"/&gt; &lt;/Host&gt; &lt;/Engine&gt; &lt;/Service&gt;&lt;/Server&gt; gitæŒç»­éƒ¨ç½²shellè„šæœ¬ è§£å†³Linux CentOSä¸­cp -f å¤åˆ¶å¼ºåˆ¶è¦†ç›–çš„å‘½ä»¤æ— æ•ˆçš„æ–¹æ³•ï¼Œç³»ç»Ÿé»˜è®¤ä½¿ç”¨cp -iä½¿ç”¨äº¤äº’æ–¹å¼é¿å…è¯¯æ“ä½œï¼Œä½†åœ¨è‡ªåŠ¨è„šæœ¬ä¸­åº”å½“é¿å…ï¼Œæ¨è\\cpã€‚ 123456789101112#update codecd /root/dowload/mall/duoshanghugit fetch origin git pull &gt; /root/dowload/mall/logs/mall_git.log &amp;#package mvn package -Dmaven.test.skip=truesleep 2s#cp war to tomcat webapp\\cp -fr /root/dowload/mall/duoshanghu/target/mall.war /usr/local/env/tomcat/webapps/mall.warsleep 1s#restart.shsh /usr/local/env/tomcat/bin/restart.sh tomcaté‡å¯è„šæœ¬1234567891011121314151617181920212223242526272829303132#!/bin/sh#åˆå§‹åŒ–å…¨å±€ç¯å¢ƒå˜é‡. /etc/profile#set java environmentexport CLASSPATH=$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib#æŸ¥æ‰¾tomcatçš„pidpid=`ps aux | grep tomcat | grep -v grep | grep -v Restart | grep -v restart | awk '&#123;print $2&#125;'`echo \"the tomcat pid is $pid\"#åˆ¤æ–­tomcatè¿›ç¨‹æ˜¯å¦å­˜åœ¨if [ -n \"$pid\" ];then sleep 1 pid=`ps aux | grep tomcat | grep -v grep | grep -v restart | grep -v Restart | awk '&#123;print $2&#125;'` if [ -n \"$pid\" ]; then sleep 1 echo \"tomcatè¿›ç¨‹å°†è¢«æ€?\" kill -9 $pid fi sleep 1 echo \"tomcatè¿›ç¨‹å·²ç»è¢«æ€æ­»ï¼Œå…ˆé‡æ–°å¯åŠ¨tomcat.\" service tomcat status sleep 1s service tomcat startelse echo \"tomcatè¿›ç¨‹ä¸å­˜åœ¨ï¼Œå…ˆé‡æ–°å¯åŠ¨tomcat.\" service tomcat status sleep 1s service tomcat startfi mavenç¼–è¯‘å®Œæ•´ä¾èµ–ç®¡ç†1ã€æ¥æº è§£å†³webapp/WEB-INF/libç›®å½•ä¸‹çš„jaråŒ…æ— æ³•ç”¨mavenæ‰“åŒ…ï¼Œä¸”åœ¨linuxMavenç¼–è¯‘æŠ¥é”™[ERROR] Fatal Error: Unable to find package java.lang in classpath or bootclasspathï¼Œè‡´å‘½é”™è¯¯: åœ¨ç±»è·¯å¾„æˆ–å¼•å¯¼ç±»è·¯å¾„ä¸­æ‰¾ä¸åˆ°ç¨‹åºåŒ… java.lang 2ã€è§£å†³æ–¹æ³•Linuxè§£å†³åŠæ³•ï¼Œä½¿ç”¨mavenè‡ªå¸¦çš„å˜é‡${path.separator}è·¯å¾„åˆ†éš”ç¬¦ï¼ŒåŸå› æ˜¯åœ¨Windowsä¸‹æ˜¯åˆ†å·;ï¼Œåœ¨linuxä¸‹æ˜¯å†’å·: åŒæ—¶é…ç½®å¯¼å…¥webapp/WEB-INF/libå’Œjdkçš„rt.jarã€jce.jarï¼Œå®Œç¾è§£å†³ç¯å¢ƒé…ç½®å¸¦æ¥çš„æ— æ³•packageæ‰¾ä¸åˆ°ä¾èµ–é—®é¢˜ã€‚ pom.xmlï¼š12345678910111213141516171819202122232425262728293031323334&lt;build&gt; &lt;finalName&gt;$&#123;artifactId&#125;&lt;/finalName&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;compilerArguments&gt; &lt;verbose /&gt; &lt;bootclasspath&gt;$&#123;java.home&#125;/lib/rt.jar$&#123;path.separator&#125;$&#123;java.home&#125;/lib/jce.jar&lt;/bootclasspath&gt; &lt;extdirs&gt;$&#123;basedir&#125;/src/main/webapp/WEB-INF/lib&lt;/extdirs&gt; &lt;/compilerArguments&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.*&lt;/include&gt; &lt;/includes&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.properties&lt;/include&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;/build&gt; å‚è€ƒè§£å†³Nginxåä»£Tomcat Httpã€Httpsæ··åˆå†…å®¹æŠ¥é”™ è§£å†³WEB-INF/libç›®å½•ä¸‹çš„jaråŒ…æ— æ³•ç”¨mavenæ‰“åŒ… åé¦ˆä¸å»ºè®® å½“äº†ç»„é•¿é¢è¯•åŠ è¿ç»´ï¼Œå¯¹æ¥ä¸€å †æ”¯ä»˜å’Œç‰©æµã€çŸ­ä¿¡å’Œæ¨é€è´¦å·ï¼Œä»Šå¤©è®°å½•ä¸€ä¸‹é¢å‘DevOpsï¼ markdownåŸæ–‡ä»¶åœ¨githubé‡Œé¢ï¼Œæ„Ÿè°¢å„ä½å¤§ä½¬çœ‹å®˜starï¼Œé¢è¯•æˆ‘è¦å¾€è„¸ä¸Šè´´é‡‘å“ˆå“ˆå“ˆğŸ˜‚ã€‚ é‚®ç®±ï¼šcaochikai@qq.comï¼Œæœ‰é—®é¢˜å‘é‚®ä»¶ã€‚","tags":[{"name":"Linux","slug":"Linux","permalink":"https://caochikai.github.io/tags/Linux/"},{"name":"nginx","slug":"nginx","permalink":"https://caochikai.github.io/tags/nginx/"},{"name":"tomcat","slug":"tomcat","permalink":"https://caochikai.github.io/tags/tomcat/"},{"name":"maven","slug":"maven","permalink":"https://caochikai.github.io/tags/maven/"}]},{"title":"JVMè®°å½•","date":"2019-09-14T04:32:49.000Z","path":"2019/09/14/JVMè®°å½•/","text":"JVMè®°å½•ä¸€ã€é”™è¯¯ èƒŒæ™¯ï¼šè‡ªåŠ¨ç­”é¢˜çˆ¬è™«ç”±äºä¹°çš„è…¾è®¯äº‘1æ ¸2G1Mï¼ŒJenkinsã€springbootçˆ¬è™«å’Œç«ç‹æµè§ˆå™¨é©±åŠ¨ã€‚ çŸ¥è¯†èƒŒæ™¯ï¼šJDWPï¼šè°ƒè¯•ç½‘ç»œåè®®(Java Debug Wire Protocol)ï¼›è°ƒè¯•çº¿åè®®ï¼›jvmtiï¼šï¼ˆJava Virtual Machine Tool Interfaceï¼‰jvmä»£ç†ï¼› çŒœæµ‹ï¼šSeleniumé€šè¿‡driveré©±åŠ¨Firefoxæµè§ˆå™¨ï¼Œå¤šæ¬¡æ— æ³•å…³é—­æµè§ˆå™¨é€ æˆå†…å­˜æ— æ³•é‡Šæ”¾æœ€åæº¢å‡ºï¼› å¼•ç”¨æ–‡ç« ï¼ˆæœ‰å…´è¶£å¯æ·±å…¥äº†è§£ï¼‰ï¼šjvmti agenté»‘ç§‘æŠ€ï¼Œé˜¿é‡Œäº‘äº‘ç›‘æ§ï¼› 1FATAL ERROR in native method: JDWP Can&#39;t allocate jvmti memory, jvmtiError&#x3D;JVMTI_ERROR_OUT_OF_MEMORY(110) åé¦ˆä¸å»ºè®® ç«‹ä¸ªflagï¼šä¸å®šæœŸæ›´æ–°ï¼Œä¸€æ›´ä¸€å‘¨ã€‚ markdownåŸæ–‡ä»¶åœ¨githubé‡Œé¢ï¼Œæ„Ÿè°¢å„ä½å¤§ä½¬çœ‹å®˜starï¼Œé¢è¯•æˆ‘è¦å¾€è„¸ä¸Šè´´é‡‘å“ˆå“ˆå“ˆğŸ˜‚ã€‚ é‚®ç®±ï¼šcaochikai@qq.comï¼Œæœ‰é—®é¢˜å‘é‚®ä»¶ã€‚","tags":[{"name":"spring","slug":"spring","permalink":"https://caochikai.github.io/tags/spring/"},{"name":"JVM","slug":"JVM","permalink":"https://caochikai.github.io/tags/JVM/"}]},{"title":"å·¥å…·æ”¶è—â€”â€”ideaæ¨èæ’ä»¶","date":"2019-05-22T12:34:48.000Z","path":"2019/05/22/å·¥å…·æ”¶è—â€”â€”ideaæ¨èæ’ä»¶/","text":"å·¥å…·æ”¶è—â€”â€”ideaæ¨èæ’ä»¶ä¸€ã€æ¦‚å¿µ â€‹ å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œåšä¸»æ˜¯ä¸ªæ­»å¿ å·¥å…·æ´¾ï¼Œä¸ºäº†è§£å†³ä¸€ä¸ªå¤§é—®é¢˜å¯èƒ½ä¼šæ”¶é›†å¤šä¸ªå·¥å…·å’Œæ–¹æ¡ˆï¼Œç„¶åæ±‚è¯å¯¹æ¯”å‡ºä½“éªŒæŠ¥å‘Šã€‚åç»­æ–‡ç« æœ‰ä¸€å¤§ç±»å°±æ˜¯å·¥å…·ç±»æ¨èï¼Œè€Œæœ¬ç¯‡æ–‡ç« é‡ç‚¹å°±æ˜¯idea å®‰è£…æ’ä»¶è®°å½•ï¼Œç®€è¦è®°å½•å®‰è£…æ–¹æ³•å¿«é€Ÿæ­å»ºä¸ªæ€§åŒ–ideaï¼Œè¿˜æœ‰ä¸€äº›å…³äºUIæ–¹é¢æ’ä»¶å¯è°“å¤šä¸èƒœæ•°ï¼Œè€Œä¸”æ¯ä¸ªäººå£å‘³ä¸ä¸€ï¼Œè¯·å„ä½è‡ªè¡Œé€‰æ‹©â€”â€”æ’ä»¶æœç´¢æŠ€å·§tagsä¸ºThemeæˆ–è€…UIã€‚ æ’ä»¶åˆ—è¡¨æœ€å¼ºå¤§æ’ä»¶å«å†•ä¹‹ç‹â€”â€”lambdaè¡¨è¾¾å¼ åç§° æè¿° JRebel ä»£æ›¿springboot devçƒ­éƒ¨ç½²æ–¹æ¡ˆï¼Œæœ€æ–¹ä¾¿æ¿€æ´»æ–¹å¼ Lombok ç²¾ç®€beanï¼Œå„ç§åŠŸèƒ½å¼ºå¤§åˆå®ç”¨æ³¨è§£ï¼Œæ¬ç –äººçš„MVPï¼Œç»“åˆHutoolå®åœ¨å®Œç¾ AceJump å…‰æ ‡è·³è·ƒï¼Œæ›¿ä»£vimä¸äºŒä¹‹é€‰ MavenHelper å¿«é€Ÿåˆ†æmaven åŒ…å†²çªçš„é—®é¢˜ï¼Œæœç´¢åŒ…å MyBatis Log Plugin Restore the mybatis generate sql to original whole sql.ï¼ˆæ‹¼æ¥å®Œæ•´sqlï¼‰ Log Support 2 å¿«é€Ÿlog.info()ï¼Œç»“åˆLombokæ’ä»¶æ³¨è§£@Slf4jå¯ä»¥è¯´æ— æ•Œ Free Mybatis plugin Mybaitsæ”¯æŒè·³è½¬ï¼Œæœ‰é’±å¤§çˆ·è¯·æ”¶è´¹ç‰ˆMybatis pluginå¼ºå¤§ç ´è§£è¾ƒå°‘ï¼Œå·®è¯„ Rainbow Brackets å½©è™¹æ‹¬å·ï¼Œå¤šå±‚åµŒå¥—ä»£ç æ˜¾ç¤ºåŠ©æ‰‹ String Manipulation å„ç§å„æ ·å­—ç¬¦ä¸²æ ¼å¼è½¬åŒ– RestfulToolkit ä¸€å¥— RESTful æœåŠ¡å¼€å‘è¾…åŠ©å·¥å…·é›† Alibaba Cloud Toolkit ç»“åˆé˜¿é‡Œäº‘ï¼ˆéé˜¿é‡Œä¹Ÿæ”¯æŒï¼‰ï¼Œå¤šèŠ‚ç‚¹å‘å¸ƒå·¥å…·åŠ å¼ºåŠ›linuxå®¢æˆ·ç«¯ stackoverflow stackoverflowå¿«é€Ÿæœç´¢bugæ’ä»¶ Translation æœ€å¼ºå¤§çš„ç¿»è¯‘æ’ä»¶ï¼Œæ”¯æŒä¸­æ–‡æ›¿æ¢è‹±æ–‡ï¼Œè§£å†³èµ·è‹±æ–‡å˜é‡åéš¾çš„é‡åº¦æ‚£è€… Key Promoter X æ‰€æœ‰æ“ä½œçš„å¿«æ·é”®æç¤ºï¼Œå¿˜è®°é¼ æ ‡çœŸçš„ Cyan Light Theme A light themeï¼Œåé’è‰²å¯¹çœ¼ç›å¾ˆæŸ”å’Œèˆ’æœï¼Œé»‘æš—ä¸»é¢˜å®åœ¨ä¸é€‚åº” åé¦ˆä¸å»ºè®® 2012å¹´javaç¨‹åºå‘˜å¯ä»¥è¯´éå¸¸åƒé¦™ï¼Œä»Šå¹´2019ä»ä¸šäººæ•°æš´å¢ï¼ŒèŒä¸šå‘å±•æŒ‘æˆ˜å˜å¾—è¶Šæ¥è¶Šå¤§ï¼ç°åœ¨æµè¡Œè‡ªåŠ¨æ„å»ºå’Œè‡ªåŠ¨éƒ¨ç½²CIï¼Œå¼€å‘è¿ç»´ä¸€ä½“åŒ–dockerï¼Œæ•´ä¸ªäº’è”ç½‘éƒ½åœ¨è¿½æ±‚æ•æ·å¼€å‘çš„ä»Šå¤©ã€‚æŒæ¡ä¸€æ¬¾è¿½æ±‚æ•ˆç‡åŠŸèƒ½çš„IDEéå¸¸é‡è¦ï¼Œå¾ˆå¤šç¾¤å’Œå…¬ä¼—å·å¯¹ideå’ŒEclipseäº‰è®®å¾ˆå¤§ã€‚ä½†è¯·è®°ä½æ–¯å¤§æ—åè¨€â€”â€”è½åå°±è¦æŒ¨æ‰“ï¼Œideæœ¬èº«ä»£è¡¨é«˜æ•ˆï¼Œä½†æ˜¯æ’ä»¶ä¹Ÿåˆ«è£…å¤ªå¤šï¼Œå…å¾—å¯åŠ¨è¿˜è¦åŠå¤©å“ˆå“ˆå“ˆğŸ˜€ ï¼ˆé¦–æ¨ï¼‰æ…•è¯¾ç½‘å…è´¹æ•™ç¨‹ï¼šIntelliJ IDEAç¥å™¨ä½¿ç”¨æŠ€å·§ ï¼ˆæ¨èï¼‰å°šç¡…è°·IDEAè§†é¢‘æ•™ç¨‹ï¼šé“¾æ¥ï¼šhttps://pan.baidu.com/s/11biVBv9EI9yfL6Cee0r0LQï¼Œå¯†ç ï¼šn7hn çœ‹å®Œä¸Šé¢ä¸¤ä¸ªæ•™ç¨‹ï¼Œä½ ä¼šæ€€ç–‘è‡ªå·±ç”¨çš„ideaæ˜¯å‡çš„ï¼ŒåŸæ¥å†™ä»£ç è¿˜å¯ä»¥è¿™æ ·çš„ã€‚ é‚®ç®±ï¼šcaochikai@qq.com","tags":[{"name":"idea","slug":"idea","permalink":"https://caochikai.github.io/tags/idea/"},{"name":"tool","slug":"tool","permalink":"https://caochikai.github.io/tags/tool/"},{"name":"plugin","slug":"plugin","permalink":"https://caochikai.github.io/tags/plugin/"}]},{"title":"springbootæ•´åˆelasticsearch","date":"2019-05-21T13:40:31.000Z","path":"2019/05/21/springbootæ•´åˆelasticsearch/","text":"springbootæ•´åˆelasticsearchä¸€ã€æ¦‚å¿µ elasticsearchå®˜ç½‘æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå…·æœ‰RESTful webæ¥å£çš„javaåº”ç”¨ã€‚ç›®å‰å¼€æºè½¯ä»¶å•†ä¸šæ¯”è¾ƒä¸é”™çš„ä¾‹å­ï¼Œä¸Solrä¸€æ ·éƒ½æ˜¯åŸºäºLuceneï¼Œå¤§æ•°æ®hadoopä¹Ÿæ˜¯è„±èƒäºLuceneã€‚Solrå¼€æºè€Œä¸”ç”Ÿæ€æ¯”è¾ƒæˆç†Ÿï¼Œelasticsearchç›®å‰æœ€ç«ä¹Ÿæ˜¯å•†ä¸šåº”ç”¨æ–¹é¢éå¸¸å¥½çš„æœç´¢å¼•æ“ã€‚ 3wåŸåˆ™ï¼š question whatï¼šå¸¸è§ç«™å†…/appå†…æœç´¢æœåŠ¡éœ€æ±‚ï¼šå•†å“æ–‡ç« çš„æ¨¡ç³Šæœç´¢ï¼Œç²¾ç¡®æœç´¢ï¼Œæ‹¼éŸ³æœç´¢ ã€‚ question whyï¼šå€ŸåŠ©elasticsearchå’Œanalysis-ikä¸­æ–‡åˆ†è¯å™¨ï¼Œå¿«é€Ÿå®ç°æœç´¢æœåŠ¡åŠŸèƒ½ã€‚ howï¼šåœ¨å¾®æœåŠ¡å½“ä¸­ï¼Œé€šå¸¸åˆ©ç”¨mqæ¶ˆæ¯ä¸­é—´ä»¶æ¥åŒæ­¥æ•°æ®é›†ç¾¤æœç´¢æœåŠ¡ï¼ˆè„šæ‰‹æ¶é‡Œæ²¡æœ‰mqï¼‰ï¼Œå€ŸåŠ©ElasticsearchTemplateï¼ˆspring æ¨¡æ¿å·¥å…·ç±»å¼ºå¤§ï¼‰APIç»´æŠ¤ç´¢å¼•å’Œæœç´¢æŸ¥è¯¢ã€‚ äºŒã€è½åœ°å®ç° æ ¹æ®ç äº‘ä¼ä¸šçº§æœç´¢è„šæ‰‹æ¶çš„æ–‡æ¡£å¯çŸ¥ï¼Œæ³¨æ„ç‰ˆæœ¬ä¸ºSpringboot2.1.1+elasticsearch6.5.3ï¼Œelasticsearchå’Œanalysis-ikæ’ä»¶ç‰ˆæœ¬å¿…é¡»ç»Ÿä¸€ï¼Œè€Œä¸”æ–°ç‰ˆæœ¬elasticsearch 7ä¸é€‚ç”¨äºè¯¥å·¥ç¨‹ã€‚è¿™ä¸ªå‚è€ƒå·¥ç¨‹çš„ä¸­æ–‡åˆ†è¯æœç´¢æ•ˆæœä¸å¤ªç†æƒ³ï¼Œä¸€èˆ¬å¯Œæ–‡æœ¬çš„å†…å®¹è¿›å…¥ç´¢å¼•ä¹‹å‰è¦åˆ©ç”¨å­—ç¬¦è¿‡æ»¤å™¨æ¸…æ´—ä¸æ­£å¸¸çš„å­—ç¬¦ã€‚é€šå¸¸ä¸ºäº†ä¿è¯ç´¢å¼•æ—¶è¦†ç›–åº¦å’Œæœç´¢æ—¶å‡†ç¡®åº¦,ç´¢å¼•åˆ†è¯å™¨é‡‡ç”¨ik_max_word,æœç´¢åˆ†æå™¨é‡‡ç”¨ik_smartæ¨¡å¼ã€‚å…·ä½“elasticsearch6.5.3çš„å®‰è£…è¿‡ç¨‹è¯·å‚è€ƒç äº‘çš„README.mdï¼Œç›®å‰æ­£åœ¨åœ¨å…¬å¸é¡¹ç›®ä½¿ç”¨è¯·æ”¾å¿ƒï¼Œå•å…ƒæµ‹è¯•çš„æ•ˆæœä¹Ÿéå¸¸niceã€‚ 1ã€æ·»åŠ ä¾èµ–1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;&lt;/dependency&gt; 2ã€é…ç½®å¼•å¯¼ç±»12345#============================# é»˜è®¤çš„èŠ‚ç‚¹åç§°elasticsearchspring.data.elasticsearch.cluster-name=my-application# elasticsearch è°ƒç”¨åœ°å€ï¼Œå¤šä¸ªä½¿ç”¨â€œ,â€éš”å¼€spring.data.elasticsearch.cluster-nodes=localhost:9300 3ã€DWMQSenderåŒ…è£…rabbitTemplateå‘é€æ¶ˆæ¯åŒæ­¥æ•°æ®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778//æœåŠ¡ç±»çš„ç®€å†™å¦‚ä¸‹&#123;//æ³¨å…¥sender @AutowiredDWMQSender sender;//å‘é€å†™æ³•ArticlesMessage extends DWMQMessage&lt;æ¶ˆæ¯å†…å®¹ç±»å‹&gt;JSONObject jsonObject = JSON.parseObject(JSON.toJSONString(articles)); jsonObject.put(Groups.ACTION, Groups.ADD); sender.sendMessage(new ArticlesMessage(jsonObject));&#125;//å°è£…å‘é€mq messageimport com.alibaba.fastjson.JSON;import com.dwalk.common.exception.EU;import com.dwalk.common.mq.mto.DWMQMessage;import com.dwalk.common.utils.SU;import com.rabbitmq.client.Channel;import lombok.extern.slf4j.Slf4j;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.amqp.AmqpException;import org.springframework.amqp.core.Message;import org.springframework.amqp.core.MessagePostProcessor;import org.springframework.amqp.rabbit.annotation.RabbitHandler;import org.springframework.amqp.rabbit.core.RabbitTemplate;import org.springframework.amqp.rabbit.support.CorrelationData;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;import java.time.LocalDateTime;import java.util.concurrent.atomic.AtomicLong;/** * æ¶ˆæ¯æˆåŠŸå‘é€åˆ°MQæœåŠ¡å™¨åçš„å›è°ƒç¡®è®¤ */@Slf4j@Componentpublic class DWMQSender &#123; @Autowired RabbitTemplate rabbitTemplate; @Autowired DWMQRetry retry; // public void sendMessage(DWMQMessage mto) &#123; if( mto.getObj()==null ) &#123; EU.te(\"æ¶ˆæ¯å†…å®¹ä¸ºç©º\"); &#125; if( SU.isNull( mto.getRoutingKey()) ) &#123; EU.te(\"è·¯ç”±è§„åˆ™ä¸ºç©º\"); &#125; log.info(String.format(\"å‡†å¤‡å‘é€ã€%sã€‘\", mto.getInfo())); mto.setId(retry.generateId()); if( SU.isNull(mto.getExchange()) &amp;&amp; mto.getExpire()&lt;1 ) &#123; //é»˜è®¤çš„æ²¡æœ‰äº¤æ¢å™¨ï¼Œåˆ™ç›´æ¥å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ— rabbitTemplate.convertAndSend(mto.getRoutingKey(), mto.getObj(), new CorrelationData(mto.getId())); &#125; else if (mto.getExpire()&lt;1)&#123; //ç»è¿‡äº¤æ¢å™¨ï¼ŒæŒ‰è·¯ç”±è§„åˆ™åŒ¹é…é˜Ÿåˆ— rabbitTemplate.convertAndSend(mto.getExchange(), mto.getRoutingKey(), mto.getObj(), new CorrelationData(mto.getId())); &#125; else &#123; //é»˜è®¤çš„æ²¡æœ‰äº¤æ¢å™¨ï¼Œåˆ™ç›´æ¥å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ï¼Œå‘é€å»¶è¿Ÿæ¶ˆæ¯ rabbitTemplate.convertAndSend(mto.getRoutingKey(), mto.getObj(), message -&gt; &#123; message.getMessageProperties().setExpiration(mto.getExpire()+\"\"); return message; &#125;, new CorrelationData(mto.getId())); &#125; mto.setCtime(System.currentTimeMillis()); retry.add(mto, this); &#125;&#125; 4ã€RabbitListeneræ¥æ”¶åˆ°æ¶ˆæ¯åŒæ­¥æ•°æ®123456789101112131415161718192021222324252627282930313233343536373839/** * æœç´¢æœåŠ¡æ¥æ”¶åˆ°ç®¡ç†åå°ç”¨æˆ·ä¿®æ”¹æ–‡ç« åŒæ­¥æ¶ˆæ¯ */@Component@Slf4j//é…ç½®mqæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ–‡ä»¶åŒæ­¥æ¶ˆæ¯@RabbitListener(queues = DirectMQConfig.DIRECT_ARTICLES_ELASTIC_QUEUE)public class ArticlesReceiver extends DWMQBaseReceiver&lt;String&gt; &#123; @Autowired private ArticleETOService etoService; @Override public Class getClazz() &#123; return String.class; &#125; @Override public boolean processMessage(String mto) &#123; log.info(\"Received ç®¡ç†åå°ç”¨æˆ·-ä¿®æ”¹æ–‡ç« åŒæ­¥æ¶ˆæ¯æ¥æ”¶:&#123;&#125;\", mto); JSONObject jsonObject = JSON.parseObject(mto); String action = jsonObject.getString(Groups.ACTION); //åˆ é™¤æ“ä½œè¦åˆ é™¤ç´¢å¼•ï¼Œæ›´æ–°æ“ä½œå…ˆåˆ é™¤å ArticleETO articles = JSON.parseObject(jsonObject.toJSONString(), ArticleETO.class); String articlesId = articles.getId(); switch (action) &#123; case Groups.ADD: etoService.save(articles); break; case Groups.UPDATE: etoService.delete(articlesId); etoService.save(articles); break; case Groups.DELETE: etoService.delete(articlesId); break; &#125; return true; &#125;&#125; 5ã€å…¬å…±æœç´¢æ–¹æ³•12345678910111213141516171819202122232425262728/** * é«˜äº®æ˜¾ç¤ºï¼Œè¿”å›åˆ†é¡µ * @auther: zhoudong * @date: 2018/12/18 10:29 */ @Override public IPage&lt;Map&lt;String, Object&gt;&gt; queryHitByPage(int pageNo, int pageSize, String keyword, String indexName, String... fieldNames) &#123; // æ„é€ æŸ¥è¯¢æ¡ä»¶,ä½¿ç”¨æ ‡å‡†åˆ†è¯å™¨. QueryBuilder matchQuery = createQueryBuilder(keyword, fieldNames); // è®¾ç½®é«˜äº®,ä½¿ç”¨é»˜è®¤çš„highlighteré«˜äº®å™¨ HighlightBuilder highlightBuilder = createHighlightBuilder(fieldNames); // è®¾ç½®æŸ¥è¯¢å­—æ®µ SearchResponse response = elasticsearchTemplate.getClient().prepareSearch(indexName) .setQuery(bool) .highlighter(highlightBuilder) .setFrom((pageNo - 1) * pageSize) .setSize(pageNo * pageSize) // è®¾ç½®ä¸€æ¬¡è¿”å›çš„æ–‡æ¡£æ•°é‡ï¼Œæœ€å¤§å€¼ï¼š10000 .get(); // è¿”å›æœç´¢ç»“æœ SearchHits hits = response.getHits(); Long totalCount = hits.getTotalHits(); IPage&lt;Map&lt;String, Object&gt;&gt; page = new Page&lt;&gt;(pageNo, pageSize, totalCount); page.setRecords(getHitList(hits)); return page; &#125; åé¦ˆä¸å»ºè®® ä»Šå¤©ç»ˆäºå‡ºäº†elasticsearchæ–‡ç« ï¼Œä»¥åæˆ‘ä¼šåœ¨å¯¹åº”ä¸“é¢˜çš„æ–‡ç« æ”¾å‡ºç›¸å…³çš„ç™¾åº¦äº‘èµ„æºï¼Œè¿™äº›éƒ½æ˜¯ç½‘ä¸Šæµä¼ æ¯”è¾ƒå¹¿çš„èµ„æºï¼Œæƒ³æ‰¾å¥½çš„å­¦ä¹ èµ„æºä¹Ÿå¯ä»¥ä¸æˆ‘åˆä¼™ä¹°ç»ç‰ˆè§†é¢‘ï¼Œæœ‰é’±ä¹°æ­£ç‰ˆå§ï¼ˆä½œè€…å¾ˆç©·ï¼Œæ‰¾å·¥ä½œä»æ¥æ²¡æœ‰é€ å‡åŒ…è£…ï¼Œåªèƒ½æ··æˆè¿™ä¸ªåµæ ·ğŸ˜­ï¼Œä¸–é“ç»´è‰°ï¼Œå¦‚æœä¸æ˜¯æ„Ÿè§‰åšç å†œè¿˜ç®—æœ‰ç‚¹å¤©èµ‹ï¼Œæ—©å°±è½¬è¡Œäº†ï¼‰ã€‚ ç™¾åº¦äº‘ :ä¸‹è½½è¡—/01.Elasticsearché¡¶å°–é«˜æ‰‹ç³»åˆ—è¯¾ç¨‹ï¼Œå¯†ç ï¼šiw7f é‚®ç®±ï¼šcaochikai@qq.com","tags":[{"name":"spring","slug":"spring","permalink":"https://caochikai.github.io/tags/spring/"},{"name":"elasticsearch","slug":"elasticsearch","permalink":"https://caochikai.github.io/tags/elasticsearch/"}]},{"title":"Springbootæ•´åˆQuartzå®šæ—¶å™¨","date":"2019-05-20T12:25:37.000Z","path":"2019/05/20/Spring bootæ•´åˆQuartzå®šæ—¶å™¨/","text":"Spring bootæ•´åˆQuartzå®šæ—¶å™¨ä¸€ã€æ¦‚å¿µ quartzå®˜ç½‘æ˜¯ä¸€ä¸ªå®Œå…¨ç”± Java ç¼–å†™çš„å¼€æºä½œä¸šè°ƒåº¦æ¡†æ¶ï¼Œç»“åˆæ•°æ®åº“ç”šè‡³å¯ä»¥åšåˆ°åˆ†å¸ƒå¼è°ƒåº¦ã€‚ç›®å‰å‚è€ƒçš„RuoYiåå°è„šæ‰‹æ¶çš„å®šæ—¶ä»»åŠ¡æ¨¡å—ï¼Œæ”¯æŒåœ¨çº¿ï¼ˆæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤)ä»»åŠ¡è°ƒåº¦ï¼Œå¹¶è®°å½•æ‰§è¡Œæ—¥å¿—ä½œä¸šç»“æœã€‚ 3wåŸåˆ™ï¼š question whatï¼šå®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚å®šæ—¶ç­”é¢˜ã€å•†å®¶ç»“ç®—ç­‰éœ€æ±‚ï¼Œå¹¶ä¸”æ”¯æŒç«‹å³è¿è¡Œã€æš‚åœå’Œç¦æ­¢ã€‚ question whyï¼šå€ŸåŠ©quartz springbootç”Ÿæ€å’Œåå°è„šæ‰‹æ¶ï¼Œå¿«é€Ÿå®ç°å®šæ—¶è°ƒåº¦åŠŸèƒ½ã€‚ howï¼šå®ç°JobDetailè¿è¡Œä»»åŠ¡è¯¦æƒ…ï¼ŒTrigger è§¦å‘å™¨å®šä¹‰è§¦å‘è§„åˆ™ï¼ŒScheduler è°ƒåº¦ä¸­å¿ƒ/å®¹å™¨æ³¨å†Œå¤šä¸ª JobDetail å’Œ Triggerã€‚Trigger ä¸ JobDetail ç»„åˆå³å¯è¢«Schedulerè°ƒç”¨ã€‚ äºŒã€è½åœ°å®ç° æ ¹æ®è‹¥ä¾è„šæ‰‹æ¶çš„æ–‡æ¡£å¯çŸ¥ï¼Œå®šæ—¶ä»»åŠ¡å·¥ç¨‹æ¨¡å—ä¸ºruoyi-quartzï¼Œç»“åˆsql/quartz.sqlå¯¼å…¥å…³äºå®šæ—¶å™¨æ•°æ®åº“è¡¨ã€‚å½“ç„¶è¿™ç§åšæ³•éœ€è¦æ•°æ®åº“å’Œbootstrapï¼Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘é‡‡å–çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ä¿ç•™å®šæ—¶å’Œç«‹å³æ‰§è¡ŒåŠŸèƒ½ï¼ŒæŠ›å¼ƒæ‰‹åŠ¨åœ¨ä»£ç ç¡¬ç¼–ç æ–°åŠ å®šæ—¶å™¨ï¼Œwebç®¡ç†é¢æ¿åˆ™é€šè¿‡swaggerè§¦å‘ä»»åŠ¡è°ƒåº¦ç«‹å³æ‰§è¡Œä¸€æ¬¡ã€‚æç«¯å·æ‡’æ–¹å¼ï¼Œ@Scheduled(cron = â€œâ€)æ”¾åœ¨åœ¨cotrolleræ–¹æ³•ï¼ŒåŒäº‹æ¨èç»™æˆ‘çš„ğŸ˜€ã€‚ 1ã€æ·»åŠ ä¾èµ–1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt;&lt;/dependency&gt; 2ã€é…ç½®å¼•å¯¼ç±»1234567//æ¨¡å—åŠ è½½@EnableScheduling@EnableSwagger2@SpringBootApplicationpublic class WeixinApplication &#123;......&#125; 3ã€æ³¨å†ŒJobDetailå’ŒTrigger1234567891011121314151617181920212223/** * åœ¨çº¿è¡¨è¾¾å¼ï¼šhttp://cron.qqe2.com/ */@Slf4j@Configurationpublic class QuartzConfig &#123; public static final String TASK_CLASS_NAME = \"reportNowTask\"; @Bean public JobDetail reportNowTask() &#123; return JobBuilder.newJob(reportNowTask.class).withIdentity(TASK_CLASS_NAME).storeDurably().build(); &#125; @Bean public Trigger reportNowTaskTrigger(JobDetail reportNowTask) &#123; //cronScheduleç­‰äº@Scheduled(cron = \"\"),ä½†æ˜¯é€šè¿‡æ³¨è§£æ— æ³•é…ç½®jobkey return TriggerBuilder.newTrigger().forJob(reportNowTask) .withIdentity(\"reportNowTaskTrigger\") .withSchedule(CronScheduleBuilder.cronSchedule(\"9 0 19 * * ?\")) .build(); &#125;&#125; 4ã€ä»»åŠ¡è¯¦æƒ…ç»§æ‰¿QuartzJobBeanæˆ–è€…å®ç°Jobæ¥å£12345678@Slf4jpublic class reportNowTask extends QuartzJobBean &#123; @Override protected void executeInternal(JobExecutionContext context) throws JobExecutionException &#123; ......//ä»»åŠ¡å†…å®¹ &#125;&#125; 5ã€ç«‹å³æ‰§è¡Œ123456789101112131415161718@Slf4j@Api(tags = \"é—®é¢˜æ¨¡å—\")@RequestMapping(value = \"question\")@RestControllerpublic class QuestionController &#123; /** * ä»»åŠ¡è°ƒåº¦ç«‹å³æ‰§è¡Œä¸€æ¬¡ */ @PostMapping(\"/run\") @ResponseBody public ResponseEntity run() throws SchedulerException &#123; //apiç§˜è¯€å°±åœ¨è¿™é‡Œæ ¹æ®QuartzConfig jobKeyè§¦å‘ä½œä¸šè°ƒåº¦ scheduler.triggerJob(JobKey.jobKey(QuartzConfig.TASK_CLASS_NAME)); return ResponseEntity.ok(\"æ‰§è¡ŒæˆåŠŸï¼\"); &#125;&#125; åé¦ˆä¸å»ºè®® ä»Šå¤©ç²—ç•¥ç®€æ˜“ç‰ˆçš„å®šæ—¶ä»»åŠ¡,åŠŸèƒ½å¼ºå¤§çš„è¯·æŸ¥çœ‹è‹¥ä¾åå°è„šæ‰‹æ¶,githubå’Œç äº‘æœ‰å¾ˆå¤šç±»ä¼¼è„šæ‰‹æ¶,ä½†æ˜¯æˆ‘ä»¬æœ‰é€‰æ‹©æ€§copyå­¦ä¹ æ‰æ˜¯é‡ç‚¹ğŸ˜Šã€‚ é‚®ç®±ï¼šcaochikai@qq.com","tags":[{"name":"spring","slug":"spring","permalink":"https://caochikai.github.io/tags/spring/"},{"name":"quartz","slug":"quartz","permalink":"https://caochikai.github.io/tags/quartz/"}]},{"title":"springbootæºç åˆ†æä¹‹å¯åŠ¨è¿‡ç¨‹","date":"2019-05-19T13:50:35.000Z","path":"2019/05/19/springbootæºç åˆ†æä¹‹å¯åŠ¨è¿‡ç¨‹/","text":"springbootæºç åˆ†æä¹‹å¯åŠ¨è¿‡ç¨‹ä¸€ã€æ¦‚å¿µ è®¡åˆ’å†™ä¸€æ³¢springboot 2.xæºç åˆ†æï¼Œåªå†™å®ç”¨æ€§æ¯”è¾ƒé«˜çš„ç‰¹æ€§ï¼Œä»GitHubä¸Šçœ‹å‡ºæ›´æ–°é¢‘ç‡åœ¨ä¸€ä¸ªæœˆå·¦å³ï¼Œæ›´æ–°æå¿«éå¸¸æ´»è·ƒã€‚ ç‰ˆæœ¬å‘è¡Œ: ç‰ˆæœ¬ æ—¶é—´çº¿ è¯´æ˜ v0.5.0.M1 2013-08-06 ç¬¬ä¸€ä¸ªç‰ˆæœ¬ v2.2.0.M3 2019-05-15 å½“å‰æœ€æ–°ç‰ˆæœ¬ äºŒã€æºç åˆ†æ SpringBootçš„å¯åŠ¨å¼•å¯¼ç±»å†™æ³•å¤šæ ·ï¼Œæ ‡è®°äº†@SpringBootApplicationçš„classä½œä¸ºæºç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//ç®€æ˜“ç‰ˆ@SpringBootApplication public class MyApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(MyApplication.class, args); &#125; &#125;//é€šè¿‡ SpringApplicationBuilder API@SpringBootApplicationpublic class DiveInSpringBootApplication &#123; public static void main(String[] args) &#123; new SpringApplicationBuilder(DiveInSpringBootApplication.class) .bannerMode(Banner.Mode.CONSOLE) .web(WebApplicationType.NONE) .profiles(\"prod\") .headless(true) .run(args); &#125;&#125;//å£°æ˜newpublic class SpringApplicationBootstrap &#123; public static void main(String[] args) &#123;// SpringApplication.run(ApplicationConfiguration.class,args); Set sources = new HashSet(); // é…ç½®Class åç§° sources.add(ApplicationConfiguration.class.getName()); SpringApplication springApplication = new SpringApplication(); //é…ç½®æº springApplication.setSources(sources); //é…ç½®æ§åˆ¶å°banner springApplication.setBannerMode(Banner.Mode.CONSOLE); //å£°æ˜webç±»å‹ springApplication.setWebApplicationType(WebApplicationType.NONE); //å¤šç¯å¢ƒé…ç½®æ¿€æ´» springApplication.setAdditionalProfiles(\"prod\"); //java.awt.headlessç¦ç”¨æ¨¡å¼ springApplication.setHeadless(true); springApplication.run(args); &#125; @SpringBootApplication public static class ApplicationConfiguration &#123; &#125;&#125; ä»ä»£ç ä¸Šå¯ä»¥çœ‹å‡ºï¼Œè°ƒç”¨äº†SpringApplicationçš„é™æ€æ–¹æ³•runã€‚è¿™ä¸ªrunæ–¹æ³•ä¼šæ„é€ ä¸€ä¸ªSpringApplicationçš„å®ä¾‹ï¼Œç„¶åå†è°ƒç”¨è¿™é‡Œå®ä¾‹çš„runæ–¹æ³•å°±è¡¨ç¤ºå¯åŠ¨SpringBootã€‚å› æ­¤ï¼Œæƒ³è¦åˆ†æSpringBootçš„å¯åŠ¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ç†Ÿæ‚‰SpringApplicationçš„æ„é€ è¿‡ç¨‹ä»¥åŠSpringApplicationçš„runæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹å³å¯ã€‚ SpringApplicationçš„å‡†å¤‡è¿‡ç¨‹ é…ç½® Spring Boot Bean æºï¼šJava é…ç½® Class æˆ– XML ä¸Šä¸‹æ–‡é…ç½®æ–‡ä»¶é›†åˆï¼Œç”¨äº Spring Boot BeanDefinitionLoader è¯»å– ï¼Œå¹¶ä¸”å°†é…ç½®æºè§£æåŠ è½½ä¸ºSpring Bean å®šä¹‰ã€‚ æ¨æ–­ Web åº”ç”¨ç±»å‹ï¼šæ ¹æ®å½“å‰åº”ç”¨ ClassPath ä¸­æ˜¯å¦å­˜åœ¨ç›¸å…³å®ç°ç±»æ¥æ¨æ–­ Web åº”ç”¨çš„ç±»å‹ã€‚å‚è€ƒæ–¹æ³•ï¼šorg.springframework.boot.SpringApplication#deduceWebApplicationTypeã€‚ 123456789101112private WebApplicationType deduceWebApplicationType() &#123; if (ClassUtils.isPresent(REACTIVE_WEB_ENVIRONMENT_CLASS, null) &amp;&amp; !ClassUtils.isPresent(MVC_WEB_ENVIRONMENT_CLASS, null)) &#123; return WebApplicationType.REACTIVE; &#125; for (String className : WEB_ENVIRONMENT_CLASSES) &#123; if (!ClassUtils.isPresent(className, null)) &#123; return WebApplicationType.NONE; &#125; &#125; return WebApplicationType.SERVLET;&#125; æ¨æ–­å¼•å¯¼ç±»ï¼ˆMain Classï¼‰ï¼šæ ¹æ® Main çº¿ç¨‹æ‰§è¡Œå †æ ˆåˆ¤æ–­å®é™…çš„å¼•å¯¼ç±»ã€‚å‚è€ƒæ–¹æ³•ï¼š org.springframework.boot.SpringApplication#deduceMainApplicationClass 123456789101112131415private Class deduceMainApplicationClass() &#123; try &#123;//è·å–å †æ ˆè¾“å‡ºæ–¹æ³•åç§° StackTraceElement[] stackTrace = new RuntimeException().getStackTrace(); for (StackTraceElement stackTraceElement : stackTrace) &#123; if (\"main\".equals(stackTraceElement.getMethodName())) &#123; return Class.forName(stackTraceElement.getClassName()); &#125; &#125; &#125; catch (ClassNotFoundException ex) &#123; // Swallow and continue &#125; return null; &#125; åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹å™¨ ï¼ˆ ApplicationContextInitializer ï¼‰ï¼šåˆ©ç”¨ Spring å·¥å‚åŠ è½½æœºåˆ¶ï¼Œå®ä¾‹åŒ– ApplicationContextInitializer å®ç°ç±»ï¼Œå¹¶æ’åºå¯¹è±¡é›†åˆã€‚ 1234567891011121314//å®ç°ç±»ï¼š org.springframework.core.io.support.SpringFactoriesLoader//é…ç½®èµ„æºï¼š META-INF/spring.factories//æ’åºï¼š AnnotationAwareOrderComparator#sortprivate Collection getSpringFactoriesInstances(Class type, Class[] parameterTypes, Object... args) &#123; ClassLoader classLoader = Thread.currentThread().getContextClassLoader(); // Use names and ensure unique to protect against duplicates Set names = new LinkedHashSet&lt;&gt;( SpringFactoriesLoader.loadFactoryNames(type, classLoader)); List instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names); AnnotationAwareOrderComparator.sort(instances); return instances; &#125;Â· åŠ è½½åº”ç”¨äº‹ä»¶ç›‘å¬å™¨ï¼ˆ ApplicationListener ï¼‰ï¼šåˆ©ç”¨ Spring å·¥å‚åŠ è½½æœºåˆ¶ï¼Œå®ä¾‹åŒ– ApplicationListener å®ç°ç±»ï¼Œå¹¶æ’åºå¯¹è±¡é›†åˆã€‚ SpringApplication è¿è¡Œé˜¶æ®µ åŠ è½½ SpringApplication è¿è¡Œç›‘å¬å™¨ï¼ˆ SpringApplicationRunListeners ï¼‰ï¼šåˆ©ç”¨ Spring å·¥å‚åŠ è½½æœºåˆ¶ï¼Œè¯»å– SpringApplicationRunListener å¯¹è±¡é›†åˆï¼Œå¹¶ä¸”å°è£…åˆ°ç»„åˆç±»SpringApplicationRunListenersã€‚ è¿è¡Œ SpringApplication è¿è¡Œç›‘å¬å™¨ï¼ˆ SpringApplicationRunListeners ï¼‰ï¼š started(runæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ç«‹é©¬æ‰§è¡Œï¼›å¯¹åº”äº‹ä»¶çš„ç±»å‹æ˜¯ApplicationStartedEvent) environmentPrepared(ApplicationContextåˆ›å»ºä¹‹å‰å¹¶ä¸”ç¯å¢ƒä¿¡æ¯å‡†å¤‡å¥½çš„æ—¶å€™è°ƒç”¨ï¼›å¯¹åº”äº‹ä»¶çš„ç±»å‹æ˜¯ApplicationEnvironmentPreparedEvent) contextPrepared(ApplicationContextåˆ›å»ºå¥½å¹¶ä¸”åœ¨sourceåŠ è½½ä¹‹å‰è°ƒç”¨ä¸€æ¬¡ï¼›æ²¡æœ‰å…·ä½“çš„å¯¹åº”äº‹ä»¶) contextLoaded(ApplicationContextåˆ›å»ºå¹¶åŠ è½½ä¹‹åå¹¶åœ¨refreshä¹‹å‰è°ƒç”¨ï¼›å¯¹åº”äº‹ä»¶çš„ç±»å‹æ˜¯ApplicationPreparedEvent) finished(runæ–¹æ³•ç»“æŸä¹‹å‰è°ƒç”¨ï¼›å¯¹åº”äº‹ä»¶çš„ç±»å‹æ˜¯ApplicationReadyEventæˆ–ApplicationFailedEvent) åˆ›å»º Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆ ConfigurableApplicationContext ï¼‰:æ ¹æ®å‡†å¤‡é˜¶æ®µçš„æ¨æ–­ Web åº”ç”¨ç±»å‹åˆ›å»ºå¯¹åº”ConfigurableApplicationContext å®ä¾‹ï¼š Web Reactiveï¼š AnnotationConfigReactiveWebServerApplicationContext Web Servletï¼š AnnotationConfigServletWebServerApplicationContext é Webï¼š AnnotationConfigApplicationContext åˆ›å»º Environmentï¼šæ ¹æ®å‡†å¤‡é˜¶æ®µçš„æ¨æ–­ Web åº”ç”¨ç±»å‹åˆ›å»ºå¯¹åº”çš„ ConfigurableEnvironment å®ä¾‹ã€‚ Web Reactiveï¼š StandardEnvironment Web Servletï¼š StandardServletEnvironment é Webï¼š StandardEnvironment runæ–¹æ³•åˆ†æ1234567891011121314151617181920212223242526272829303132public ConfigurableApplicationContext run(String... args) &#123; StopWatch stopWatch = new StopWatch(); // æ„é€ ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œè§‚å¯Ÿå™¨ stopWatch.start(); // å¼€å§‹æ‰§è¡Œï¼Œè®°å½•å¼€å§‹æ—¶é—´ ConfigurableApplicationContext context = null; configureHeadlessProperty(); // è·å–SpringApplicationRunListenersï¼Œå†…éƒ¨åªæœ‰ä¸€ä¸ªEventPublishingRunListener SpringApplicationRunListeners listeners = getRunListeners(args); // ä¸Šé¢åˆ†æè¿‡ï¼Œä¼šå°è£…æˆSpringApplicationEventäº‹ä»¶ç„¶åå¹¿æ’­å‡ºå»ç»™SpringApplicationä¸­çš„listenersæ‰€ç›‘å¬ // è¿™é‡Œæ¥å—ApplicationStartedEventäº‹ä»¶çš„listenerä¼šæ‰§è¡Œç›¸åº”çš„æ“ä½œ listeners.started(); try &#123; // æ„é€ ä¸€ä¸ªåº”ç”¨ç¨‹åºå‚æ•°æŒæœ‰ç±» ApplicationArguments applicationArguments = new DefaultApplicationArguments( args); // åˆ›å»ºSpringå®¹å™¨ context = createAndRefreshContext(listeners, applicationArguments); // å®¹å™¨åˆ›å»ºå®Œæˆä¹‹åæ‰§è¡Œé¢å¤–ä¸€äº›æ“ä½œ afterRefresh(context, applicationArguments); // å¹¿æ’­å‡ºApplicationReadyEventäº‹ä»¶ç»™ç›¸åº”çš„ç›‘å¬å™¨æ‰§è¡Œ listeners.finished(context, null); stopWatch.stop(); // æ‰§è¡Œç»“æŸï¼Œè®°å½•æ‰§è¡Œæ—¶é—´ if (this.logStartupInfo) &#123; new StartupInfoLogger(this.mainApplicationClass) .logStarted(getApplicationLog(), stopWatch); &#125; return context; // è¿”å›Springå®¹å™¨ &#125; catch (Throwable ex) &#123; handleRunFailure(context, listeners, ex); // è¿™ä¸ªè¿‡ç¨‹æŠ¥é”™çš„è¯ä¼šæ‰§è¡Œä¸€äº›å¼‚å¸¸æ“ä½œã€ç„¶åå¹¿æ’­å‡ºApplicationFailedEventäº‹ä»¶ç»™ç›¸åº”çš„ç›‘å¬å™¨æ‰§è¡Œ throw new IllegalStateException(ex); &#125;&#125; åé¦ˆä¸å»ºè®® ä¸ºäº†å¿«å¤§å¤šåˆ†æçš„ä¸å¥½å†™çš„å¾ˆä¹±ï¼Œå‡‘åˆçœ‹ä¸‹æˆ‘ä»¥åæ”¹ä¸‹æ’ç‰ˆğŸ˜‚ã€‚ é‚®ç®±ï¼šcaochikai@qq.com","tags":[{"name":"spring","slug":"spring","permalink":"https://caochikai.github.io/tags/spring/"},{"name":"quartz","slug":"quartz","permalink":"https://caochikai.github.io/tags/quartz/"}]},{"title":"åœ°ç†å®šä½ä¸šåŠ¡å®ç°","date":"2019-05-18T12:19:01.000Z","path":"2019/05/18/åœ°ç†å®šä½ä¸šåŠ¡å®ç°/","text":"åœ°ç†å®šä½ä¸šåŠ¡å®ç°ä¸€ã€æ¦‚å¿µ3wåŸåˆ™ï¼š question whatï¼šaã€é™„è¿‘ä¸€å®šèŒƒå›´çš„ç›®æ ‡ï¼ˆç”µå­å›´æ ï¼‰ï¼›bã€è¯¥ç»çº¬åº¦çš„åœ°ç†ä½ç½®åç§°ï¼ˆçœå¸‚å¿è¡—é“ï¼‰ã€‚ whyï¼šè§£å†³ä¸Šè¿°é—®é¢˜çš„æœ¬è´¨æ˜¯è·å¾—ç»çº¬åº¦ï¼Œé€”å¾„ä¸ºç¡¬ä»¶ã€GPSå®šä½æœåŠ¡ã€åŸºç«™å®šä½ï¼Œåœ°ç†ä½ç½®é€šè¿‡ç™¾åº¦ã€è°·æ­Œã€è…¾è®¯åœ°å›¾ï¼ŒåŸºæœ¬æ‰€æœ‰åœ°å›¾å…è´¹ç‰ˆéƒ½æœ‰æ—¥è®¿é—®é‡é™åˆ¶ã€‚ howï¼šé€šè¿‡å®‰å“æˆ–è€…IOSè·å–ç»çº¬åº¦ï¼Œå†å€ŸåŠ©ç™¾åº¦åœ°å›¾æ¥å£è·å–åœ°ç†ä½ç½®ï¼Œè·ç¦»ä¹Ÿå¯é€šè¿‡æ¥å£æˆ–è€…è°·æ­Œåœ°å›¾ç®—æ³•ã€‚ GPSæ˜¯è‹±æ–‡Global Positioning Systemï¼ˆå…¨çƒå®šä½ç³»ç»Ÿï¼‰çš„ç®€ç§°ã€‚ äºŒã€è§£å†³æ–¹å¼ åœºæ™¯ï¼šå°ç¨‹åºè·å–é™„è¿‘çš„å¥½å‹ï¼Œå¾®ä¿¡å®˜æ–¹æ–‡æ¡£ wx.getLocation(Object object)ã€‚ ç°è±¡ï¼šéœ€è¦ç”¨æˆ·æˆæƒï¼Œå‰ç«¯è·å¾—gps åæ ‡é€šè¿‡æ¥å£ä¼ æ•°æ®åå°ï¼Œä¿å­˜åˆ°ç”¨æˆ·è¡¨ï¼ˆ1ï¼š1å…³ç³»ï¼‰ã€‚ åœ°å›¾é€‰æ‹©ï¼šå…¶å®çº¯å‰ç«¯åŸºæœ¬ä¹Ÿèƒ½è§£å†³åŸºæœ¬é—®é¢˜ï¼Œè…¾è®¯åœ°å›¾å¯¹å°ç¨‹åºæ”¯æŒæœ€å¥½ï¼Œæ ¹æ®JavaScript SDKæ–‡æ¡£å¯ä»¥æ‹¥æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼šç»˜åˆ¶åœ°å›¾ï¼Œåœ°ç‚¹æœç´¢ï¼Œå…³é”®è¯è¾“å…¥æç¤ºï¼Œé€†åœ°å€è§£æï¼ˆåæ ‡ä½ç½®æè¿°ï¼‰ï¼Œåœ°å€è§£æï¼ˆåœ°å€è½¬åæ ‡ï¼Œè·¯çº¿è§„åˆ’ï¼Œè·ç¦»è®¡ç®—ï¼Œè·å–åŸå¸‚åˆ—è¡¨ï¼Œè·å–åŸå¸‚åŒºå¿ã€‚ ä¸šåŠ¡å‰æï¼šç”¨æˆ·å¿…é¡»æˆæƒæ‰èƒ½ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œå½“æ‹¥æœ‰æ‰€æœ‰ç”¨æˆ·ç»çº¬åº¦ï¼Œé€šè¿‡æ•°æ®åº“è¯­å¥è·å–å½“å‰ç”¨æˆ·ç»çº¬åº¦åœ¨ä¸€å®šè·ç¦»ï¼Œå¹¶ä¸”å¯ä»¥æ’è¡Œã€‚ ä¸‰ã€è½åœ°ç¼–ç sqlç‰ˆä¾‹å­ï¼š123456789101112131415161718192021222324252627#mysqlç‰ˆï¼Œæ ¹æ®è°·æ­Œåœ°å›¾å…¬å¼è®¡ç®—ç‚¹æ­Œç»çº¬åº¦ä¹‹é—´è·ç¦»ï¼Œå•ä½ä¸ºmï¼ˆç±³ï¼‰select e.id, e.longitude, e.latitude, ROUND( 6378.138 * 2 * ASIN( SQRT( POW( SIN( ( e.latitude * PI() / 180 - 23.12463 * PI() / 180 ) / 2 ), 2 ) + COS(e.latitude * PI() / 180) * COS(23.12463 * PI() / 180) * POW( SIN( ( e.longitude * PI() / 180 - 113.36189 * PI() / 180 ) / 2 ), 2 ) ) ) * 1000 ) AS distanceFROM dw_dbei_user ehaving distance &lt; 4000 å·¥å…·ç±»ï¼ˆè·å–ä¸¤ç‚¹è·ç¦»ï¼‰ï¼š12345678910111213141516171819202122232425262728293031323334public class MapUtils &#123; //private static double EARTH_RADIUS = 6378.137; private static double EARTH_RADIUS = 6371.393; private static double rad(double d) &#123; return d * Math.PI / 180.0; &#125; /** * è®¡ç®—ä¸¤ä¸ªç»çº¬åº¦ä¹‹é—´çš„è·ç¦» * * @param lat1 çº¬åº¦1 * @param lng1 ç»åº¦1 * @param lat2 çº¬åº¦2 * @param lng2 ç»åº¦2 * @return è®¡ç®—ç»“æœå•ä½ï¼šç±³ */ public static double GetDistance(double lat1, double lng1, double lat2, double lng2) &#123; double radLat1 = rad(lat1); double radLat2 = rad(lat2); double a = radLat1 - radLat2; double b = rad(lng1) - rad(lng2); double s = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(a / 2), 2) + Math.cos(radLat1) * Math.cos(radLat2) * Math.pow(Math.sin(b / 2), 2))); s = s * EARTH_RADIUS; s = Math.round(s * 1000); return s; &#125; public static void main(String[] args) &#123; double v = GetDistance(113.36199, 23.12463, 113.36189, 23.12463); System.out.println(v); &#125;&#125; åé¦ˆä¸å»ºè®® å°½é‡æ¯å¤©ä¸æ–­æ›´ï¼Œåšä¸ªè‡ªå¾‹è€…ï¼ŒmarkdownåŸæ–‡ä»¶åœ¨githubé‡Œé¢ï¼Œæ„Ÿè°¢å„ä½å¤§ä½¬çœ‹å®˜starï¼Œé¢è¯•æˆ‘è¦å¾€è„¸ä¸Šè´´é‡‘å“ˆå“ˆå“ˆğŸ˜‚ã€‚ é‚®ç®±ï¼šcaochikai@qq.com","tags":[{"name":"sql","slug":"sql","permalink":"https://caochikai.github.io/tags/sql/"},{"name":"im","slug":"im","permalink":"https://caochikai.github.io/tags/im/"}]},{"title":"åˆæ¢ç¼“å­˜","date":"2019-05-17T15:34:21.000Z","path":"2019/05/17/åˆæ¢ç¼“å­˜/","text":"å¤šçº§ç¼“å­˜æ¶æ„ç¼“å­˜è®¾è®¡ç†å¿µï¼š ç¼“å­˜å¸¸ç”¨çš„å¯¹è±¡æˆ–è€…æ•°æ®ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€æé«˜æ•ˆç‡ã€‚ ç¼“å­˜å‘½ä¸­ç‡ å³ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®çš„æ¬¡æ•° ä¸ æ€»è¯»å–æ¬¡æ•°çš„æ¯”ç‡ï¼Œå‘½ä¸­ç‡è¶Šé«˜è¶Šå¥½ï¼š ç¼“å­˜ç­–ç•¥ï¼š ç§»é™¤ç­–ç•¥ï¼šFIFOï¼ˆFirst In First Outï¼‰ï¼ŒLRUï¼ˆLeast Recently Usedï¼‰ï¼ŒLFUï¼ˆLeast Frequently Usedï¼‰ã€‚ TTLï¼ˆTime To Liveï¼‰ï¼šç¼“å­˜å­˜æ´»æœŸ TTIï¼ˆTime To Idleï¼‰ï¼šç©ºé—²å­˜æ´»æœŸ spring cache ä¸€ã€æ¦‚å¿µ è‡ªSpring 3.1èµ·ï¼Œæä¾›æ³¨è§£ç¼“å­˜ï¼Œå¹¶ä¸”æä¾›äº‹åŠ¡å›æ»šæ—¶ä¹Ÿè‡ªåŠ¨å›æ»šç¼“å­˜ï¼Œå¹¶ä¸”æ”¯æŒSPELè¡¨è¾¾å¼ã€‚ äºŒã€å…¥é—¨ä»£ç 1ã€æ·»åŠ ä¾èµ–ï¼Œä¾‹å¦‚mavençš„pom.xml(Springboot); 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt; &lt;artifactId&gt;spring-boot-starter-cache&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependency&gt; 2ã€æ·»åŠ ä¸€ç§cacheManagerçš„beanå®ç°ç±»ï¼Œå¸¸è§ConcurrentMapCacheã€EhCacheCacheã€RedisCacheï¼› 123456@Beanpublic CacheManager cacheManager() &#123; SimpleCacheManager cacheManager &#x3D; new SimpleCacheManager(); cacheManager.setCaches(Collections.singletonList(new ConcurrentMapCache(&quot;models&quot;))); return cacheManager;&#125; 3ã€é…ç½®æ¨¡å—åŠ è½½æ³¨è§£@EnableCaching ä¸‰ã€ä¸»è¦æ³¨è§£1ã€@Cacheableï¼šå°†æ–¹æ³•è¿”å›å€¼ä½œä¸ºç¼“å­˜ value (ä¹Ÿå¯ä½¿ç”¨ cacheNames) : å¯çœ‹åšå‘½åç©ºé—´ï¼Œè¡¨ç¤ºå­˜åˆ°å“ªä¸ªç¼“å­˜é‡Œäº†ã€‚ key : è¡¨ç¤ºå‘½åç©ºé—´ä¸‹ç¼“å­˜å”¯ä¸€key,ä½¿ç”¨Spring Expression Language(ç®€ç§°SpEL,è¯¦è§å‚è€ƒæ–‡çŒ®[5])ç”Ÿæˆã€‚ condition : è¡¨ç¤ºåœ¨å“ªç§æƒ…å†µä¸‹æ‰ç¼“å­˜ç»“æœ(å¯¹åº”çš„è¿˜æœ‰unless,å“ªç§æƒ…å†µä¸ç¼“å­˜),åŒæ ·ä½¿ç”¨SpEL 2ã€@CacheEvictï¼šåˆ é™¤ç¼“å­˜æ³¨è§£ 3ã€@CachePutï¼šåˆ·æ–°æ³¨è§£ ehcache ä¸€ã€æ¦‚å¿µäºŒã€å…¥é—¨ä»£ç 1ã€ç¼“å­˜åˆ†ç»„ï¼Œè¦å¯¹åˆ†ç»„è¿›è¡Œå…¨æ–°CacheConfiguration ï¼Œä¸ºäº†é«˜æ•ˆä½¿ç”¨é…ç½®è‡ªå®šä¹‰å±æ€§æå–å™¨ã€‚é»˜è®¤çš„å±æ€§å¤„ç†å™¨æ˜¯JavaBeanAttributeExtractorã€‚ 123456789101112131415161718192021222324252627282930@Bean public EhCacheGroupBeanPostProcessor addCache() &#123; System.out.println(&quot;.......æ·»åŠ ç¼“å­˜ç»„........&quot;); return new EhCacheGroupBeanPostProcessor(); &#125; &#x2F;&#x2F;åç½®å¤„ç†å™¨ public static class EhCacheGroupBeanPostProcessor implements BeanPostProcessor &#123; @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; &#x2F;&#x2F;æ ¹æ®å‰é¢åˆå§‹åŒ–å®Œæˆçš„beanNameè¿›ä¸€æ­¥æ“ä½œ if(beanName.equals(&quot;appEhCacheCacheManager&quot;) ) &#123; EhCacheCacheManager manager &#x3D; (EhCacheCacheManager)bean; CacheManager cacheManager &#x3D; manager.getCacheManager();&#x2F;&#x2F; æ–‡ç« ç¼“å­˜å‘½ä¸­é…ç½®needUpdate CacheConfiguration configuration &#x3D; new CacheConfiguration(ReadCacheNames.æ–‡ç« ç¼“å­˜,10000); Searchable searchable &#x3D; new Searchable(); searchable.setKeys(false); searchable.setValues(false); &#x2F;&#x2F;åŠ¨æ€ç´¢å¼• searchable.setAllowDynamicIndexing(true); searchable.addSearchAttribute(new SearchAttribute().name(&quot;needUpdate&quot;).className(&quot;com.dwalk.social.common.util.ArticlesAttributeExtractor&quot;)); configuration.eternal(true).addSearchable(searchable); Cache articlesCache &#x3D; new Cache(configuration); cacheManager.addCache(articlesCache); cacheManager.addCache(ReadCacheNames.çƒ­ç‚¹æ–‡ç« ç¼“å­˜); &#125; return bean; &#125; &#125; 2ã€ä½¿ç”¨springå†…ç½®å®šæ—¶å™¨ï¼Œå¹¶ä½¿ç”¨ehcacheæŸ¥è¯¢apiè¿›è¡Œç¼“å­˜æŸ¥è¯¢ã€‚ 123456789101112131415161718192021222324 @Scheduled(cron &#x3D; &quot;0 0&#x2F;1 * * * ?&quot;) private void synchronize() &#123; Cache cache &#x3D; cacheManager.getCache(ReadCacheNames.æ–‡ç« ç¼“å­˜); int size &#x3D; cache.getSize(); if (size &gt; 0) &#123; Query query &#x3D; cache.createQuery(); Attribute searchAttribute &#x3D; cache.getSearchAttribute(&quot;needUpdate&quot;); &#x2F;&#x2F;æŒ‡å®šæŸ¥è¯¢çš„ query.includeAttribute(searchAttribute); query.includeValues(); Results execute &#x3D; query.addCriteria(searchAttribute.eq(true)).execute(); List all &#x3D; execute.all(); log.info(&quot;æŸ¥è¯¢æ–‡ç« ç¼“å­˜çš„å¤§å°ï¼š&#123;&#125;&quot;, all.size()); for (Result result : all) &#123; ArticlesDTO articles &#x3D; (ArticlesDTO) result.getValue(); articles.setNeedUpdate(false); Articles target &#x3D; new Articles();&#x2F;&#x2F; åŒæ­¥æµè§ˆé‡ã€è§†é¢‘æ’­æ”¾é‡ã€è¯„è®ºæ•°ã€ç‚¹èµæ•°ã€æ”¶è—æ•° target.setVisitorNum(articles.getVisitorNum()).setCommentNum(articles.getCommentNum()). setPlayNum(articles.getPlayNum()).setLikeNum(articles.getLikeNum()).setCollectNum(articles.getCollectNum()); articlesService.updateById(target); &#125; &#125; &#125; ä¸‰ã€æ€»ç»“1ã€éœ€è¦ç†Ÿæ‚‰springæ¥å£è®¾è®¡ï¼Œä»¥æ¥å£ä½¿ç”¨æ¡†æ¶ï¼Œè¦ä¸ç„¶å®˜æ–¹apiä½¿ç”¨éœ€äº†è§£è¯¸å¤šç»†èŠ‚ã€‚ å››ã€ä¸€äºŒçº§ç¼“å­˜ å½“é‡åˆ°@Cacheableè¿”å›ä¸ºnullè®°å½•ï¼Œä¸ºäº†æˆåŠŸåºåˆ—åŒ–nullï¼Œä½¿ç”¨äº†org.springframework.cache.support.NullValueå¯¹è±¡ä»£æ›¿nullã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889com.alibaba.fastjson.JSONException: autoType is not support. org.springframework.cache.support.NullValue1ã€èµ·æºä¸€äºŒçº§ç¼“å­˜é‡å†™get()æ–¹æ³•public class EhRedisCache extends AbstractValueAdaptingCache &#123; éƒ¨åˆ†ä»£ç çœç•¥â€¦â€¦ @Override public T get(Object key, Callable valueLoader) &#123; try &#123; lock.lock(); value &#x3D; lookup(key); if(value !&#x3D; null) &#123; return (T) value; &#125; value &#x3D; valueLoader.call(); &#x2F;&#x2F;toStoreValueæ˜¯AbstractValueAdaptingCacheæŠ½è±¡ç±»çš„æ–¹æ³• Object storeValue &#x3D; toStoreValue(value); put(key, storeValue); return (T) value; &#125; catch (Exception e) &#123; throw new ValueRetrievalException(key, valueLoader, e.getCause()); &#125; finally &#123; lock.unlock(); &#125; &#125;&#125;2ã€toStoreValueåˆ¤æ–­userValue &#x3D;&#x3D; null åˆ™return NullValue.INSTANCE -&gt; public static final Object INSTANCE &#x3D; new NullValue();public abstract class AbstractValueAdaptingCache implements Cache &#123; protected Object toStoreValue(@Nullable Object userValue) &#123; if (userValue &#x3D;&#x3D; null) &#123; if (this.allowNullValues) &#123; return NullValue.INSTANCE; &#125; throw new IllegalArgumentException( &quot;Cache &#39;&quot; + getName() + &quot;&#39; is configured to not allow null values but null was provided&quot;); &#125; return userValue; &#125;&#125;3ã€åºåˆ—åŒ–ååºåˆ—åŒ–public class FastJsonRedisSerializer implements RedisSerializer &#123; @Override public T deserialize(byte[] bytes) throws SerializationException &#123; if (null &#x3D;&#x3D; bytes || bytes.length &lt;&#x3D; 0) &#123; return null; &#125; String str &#x3D; new String(bytes, DEFAULT_CHARSET); return (T) JSON.parseObject(str, clazz); &#125;&#125;4ã€jsonParserè§£æç±»å‹public class com.alibaba.fastjson.parser.DefaultJSONParser implements Closeable &#123; public final Object parseObject(final Map object, Object fieldName) &#123; éƒ¨åˆ†ä»£ç çœç•¥â€¦â€¦ Class clazz &#x3D; null; if (object !&#x3D; null &amp;&amp; object.getClass().getName().equals(typeName)) &#123; clazz &#x3D; object.getClass(); &#125; else &#123; &#x2F;&#x2F;com.alibaba.fastjson.parser.DefaultJSONParser#configæ‰§è¡Œ clazz &#x3D; config.checkAutoType(typeName, null, lexer.getFeatures()); &#125; &#125;&#125;5ã€å¼‚å¸¸æŠ›å‡ºç‚¹TypeUtils.getClassFromMapping(typeName) -ã€‹ typeNameä¸ºorg.springframework.cache.support.NullValuepublic Class checkAutoType(String typeName, Class expectClass, int features) &#123; if (Arrays.binarySearch(denyHashCodes, hash) &gt;&#x3D; 0 &amp;&amp; TypeUtils.getClassFromMapping(typeName) &#x3D;&#x3D; null) &#123; throw new JSONException(&quot;autoType is not support. &quot; + typeName); &#125;&#125;6ã€TypeUtilsçš„getClassFromMappingæ–¹æ³•è¿”å›null public static Class getClassFromMapping(String className)&#123; return mappings.get(className); &#125;7ã€TypeUtilsä¸æ”¯æŒorg.springframework.cache.support.NullValueprivate static ConcurrentMap&gt; mappings &#x3D; new ConcurrentHashMap&gt;(16, 0.75f, 1);&#x2F;&#x2F;mappingsç±»å‹ç™½åå•private static void addBaseClassMappings()&#123; mappings.put(&quot;byte&quot;, byte.class); mappings.put(&quot;short&quot;, short.class); mappings.put(&quot;int&quot;, int.class); mappings.put(&quot;long&quot;, long.class); mappings.put(&quot;float&quot;, float.class); mappings.put(&quot;double&quot;, double.class); mappings.put(&quot;boolean&quot;, boolean.class); éƒ¨åˆ†ä»£ç çœç•¥â€¦â€¦ fastJsonå®˜æ–¹æ²¡æœ‰æ”¯æŒorg.springframework.cache.support.NullValue&#125; åé¦ˆä¸å»ºè®® ä»Šå¤©å¤å‡ºå†™åšå®¢ï¼Œä¸€æ˜¯æ„Ÿè§‰æ‡’äº†æœŸæœ›è¿›æ­¥ï¼ŒäºŒæ˜¯ä¸ºäº†ç§¯ç´¯çŸ¥è¯†æ–¹ä¾¿copyğŸ˜‚ã€‚ é‚®ç®±ï¼š&#x63;&#97;&#x6f;&#99;&#104;&#x69;&#x6b;&#97;&#105;&#64;&#113;&#113;&#x2e;&#99;&#x6f;&#109;","tags":[{"name":"spring","slug":"spring","permalink":"https://caochikai.github.io/tags/spring/"}]},{"title":"AndroidAdb","date":"2017-02-05T12:49:09.000Z","path":"2017/02/05/AndroidAdb/","text":"Android adbè°ƒè¯•å·¥å…·â€“æ¸…é™¤é”å±å¯†ç è¯¯è§£@(Android)[è°ƒè¯•å·¥å…·|å®ç”¨æ•™ç¨‹|adbå‘½ä»¤] Android Studio ADBå®˜æ–¹æ–‡æ¡£ ADBå…¨ç§°ä¸º Android Debug Bridge, æ˜¯android é‡Œçš„ä¸€ä¸ªè°ƒè¯•å·¥å…·, ç”¨è¿™ä¸ªå·¥å…·å¯ä»¥ç›´æ¥æ“ä½œç®¡ç†androidæ¨¡æ‹Ÿå™¨æˆ–è€…çœŸå®çš„andriodè®¾å¤‡æ‰‹æœºã€‚å¦‚æœä½ å®‰è£…äº†Android SDKï¼ˆæˆ–è€…ä¸‹è½½adbå·¥å…·åŒ…ï¼Œä½“ç§¯å°ï¼‰,å­˜æ”¾sdkçš„platform-toolsç›®å½•ä¸‹ï¼Œåœ¨ å‘½ä»¤è¡Œcmdä½¿ç”¨éœ€è¦é…ç½®è·¯å¾„ï¼ˆandroid_sdk/platform-tools/adb.exe ï¼‰åˆ°ç¯å¢ƒå˜é‡é‡Œã€‚å®ƒå¯ä¸ºå„ç§è®¾å¤‡æ“ä½œæä¾›ä¾¿åˆ©ï¼Œå¦‚å®‰è£…å’Œè°ƒè¯•åº”ç”¨ï¼Œä¾‹å¦‚æŸ¥çœ‹androidä¸­çš„æ•°æ®åº“ï¼Œæä¾›å¯¹ Unix shellï¼ˆå¯ç”¨æ¥åœ¨æ¨¡æ‹Ÿå™¨æˆ–è¿æ¥çš„è®¾å¤‡ä¸Šè¿è¡Œå„ç§å‘½ä»¤ï¼‰çš„è®¿é—®ã€‚è¯¥å·¥å…·ä½œä¸ºä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨ç¨‹åºï¼ŒåŒ…æ‹¬ä¸‰ä¸ªç»„ä»¶ï¼š å®¢æˆ·ç«¯ ï¼šè¯¥ç»„ä»¶å‘é€å‘½ä»¤ã€‚å®¢æˆ·ç«¯åœ¨å¼€å‘è®¡ç®—æœºä¸Šè¿è¡Œã€‚æ‚¨å¯ä»¥é€šè¿‡å‘å‡º adb å‘½ä»¤ä»å‘½ä»¤è¡Œç»ˆç«¯è°ƒç”¨å®¢æˆ·ç«¯ï¼› åå°ç¨‹åº ï¼šè¯¥ç»„ä»¶åœ¨è®¾å¤‡ä¸Šè¿è¡Œå‘½ä»¤ã€‚åå°ç¨‹åºåœ¨æ¯ä¸ªæ¨¡æ‹Ÿå™¨æˆ–è®¾å¤‡å®ä¾‹ä¸Šä½œä¸ºåå°è¿›ç¨‹è¿è¡Œï¼› æœåŠ¡å™¨ ï¼šè¯¥ç»„ä»¶ç®¡ç†å®¢æˆ·ç«¯å’Œåå°ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚æœåŠ¡å™¨åœ¨å¼€å‘è®¡ç®—æœºä¸Šä½œä¸ºåå°è¿›ç¨‹è¿è¡Œã€‚ å…³äºæ¸…é™¤è§£é”å›¾æ¡ˆ ç”¨æˆ·ç›¸å…³çš„æ–‡ä»¶accounts.dbï¼ˆgmailè´¦å·ç®¡ç†ï¼‰ï¼Œgesture.keyï¼ˆæ‰‹åŠ¿è¯†åˆ«æ–‡ä»¶ï¼‰ï¼Œpassword.keyï¼ˆå¯†ç æ–‡ä»¶ï¼‰ã€‚ä¸åŒå“ç‰Œæ‰‹æœºç³»ç»Ÿç›¸å…³æ–‡ä»¶åä¹Ÿä¼šä¸åŒ,ä¾‹å¦‚æˆ‘çš„æ‰‹æœºï¼Œåä¸º4xæ–‡ä»¶ä¸ºlocksettings.dbï¼ˆæ•°æ®åº“æ–‡ä»¶ï¼‰ã€‚ä¿®ç†åº—é‡Œçš„å¸ˆå‚…ä½¿ç”¨ä¸€ä¸ªå·¥å…·å«æ˜Ÿæµ·ç¥å™¨ï¼ˆé«˜é€šå¹³å°å¼ºåˆ·ï¼‰ï¼ŒåŠŸèƒ½è¶…ä¹æƒ³è±¡ï¼Œå‡ ä¹æ”¯æŒæ‰€æœ‰æ‰‹æœºå“ç‰Œï¼ˆç‰¹åˆ«æ˜¯è‹¹æœï¼‰æ·˜å®ä¸Šæœ‰å–ï¼Œç½‘ä¸Šå¤§éƒ¨åˆ†åŠ å¯†è¿‡ï¼å°ç±³æ‰‹æœºå«ä¸¢å¤±è§£é”ç¥å™¨ï¼ 1. ç ´è§£æ¡ä»¶ æ‰‹æœºæ‰“å¼€USBå¹¶è¿æ¥ç”µè„‘ æ‰‹æœºè¢«ROOTï¼Œå¹¶ä¸”ADBå¯ä»¥ç›´æ¥å‡çº§ä¸ºROOTç”¨æˆ· é…ç½®adbè·¯å¾„åˆ°ç¯å¢ƒå˜é‡æˆ–è€…ç›´æ¥åœ¨cmdå‘½ä»¤è¡Œé‡Œé¢åˆ‡æ¢åˆ°adbæ‰€åœ¨è·¯å¾„ 2. ç ´è§£æ­¥éª¤ *æ‰“å¼€cmdå‘½ä»¤è¡Œï¼Œç”¨ã€adb shellã€‘å‘½ä»¤è¿›å…¥shell * åˆ©ç”¨suå‘½ä»¤å°†adbæå‡ä¸ºrootç”¨æˆ·ï¼Œå¦‚æœæˆåŠŸï¼Œè¡Œé¦–ç”±$å˜æˆ #ï¼Œ#è¡¨ç¤ºrootç”¨æˆ· *è¿›å…¥data/systemç›®å½• * *lsæŸ¥çœ‹å½“å‰ç›®å½• * *ç”¨lså‘½ä»¤æŸ¥çœ‹å¯†ç æ–‡ä»¶ * ç”¨rmå‘½ä»¤åˆ é™¤å¯†ç æ–‡ä»¶ï¼Œè‹¥æ˜¯$ï¼ˆä¸æ˜¯rootï¼‰ï¼Œåˆ™ä¼šæç¤ºâ€rm failed for â€¦ Permission deniedâ€ï¼Œæƒé™ä¸è¶³ 12345$ adb shell $ su# cd /data/system# ls# rm locksettings.db è¾“å…¥rebootæˆ–æ‰‹åŠ¨é‡å¯æ‰‹æœºç”Ÿæ•ˆã€‚äº²æµ‹åä¸ºè£è€€4Xæœ‰æ•ˆï¼Œåˆ é™¤é”å±å¯†ç åï¼ŒæŒ‡çº¹è§£é”è‡ªåŠ¨å¤±æ•ˆï¼Œæ‰€ä»¥æ­¤æ–¹æ³•ä¹Ÿå¯ä»¥ç ´è§£æŒ‡çº¹è§£é”ï¼ï¼é‡æ–°è®¾ç½®é”å±å¯†ç åï¼Œä»¥å‰è®¾ç½®çš„æŒ‡çº¹è§£é”åˆå¯ä»¥ç”¨äº†ã€‚ 3. æ³¨æ„äº‹é¡¹çœ‹åˆ°è¿™å„¿å°±æ˜ç™½äº†ï¼Œå³ä¾¿æ‰‹æœºRoot+æ‰“å¼€USBè°ƒè¯•ï¼Œä¹Ÿæ˜¯æ— æ³•é€šè¿‡ADBè§£é”æ‰‹æœºçš„ã€‚å› ä¸ºæƒ³è¦æƒ³è¦è§£é”ï¼Œå°±å¾—åˆ é™¤/data/system ä¸‹çš„ç›¸å…³æ–‡ä»¶ï¼Œå¯åˆ é™¤éœ€è¦ç”±Superuseræˆ–è€…kingrootæˆäºˆADB shellæƒé™ï¼Œè€Œæˆæƒéœ€è¦è§£é”æ‰“å¼€æ‰‹æœºåæ“ä½œSuperuserç¨‹åºã€‚å³è§£é”éœ€è¦ç”¨åˆ°è§£é”åçš„æ‰‹æœºæ“ä½œï¼Œå°±åƒæ˜¥æ™šå°å“ã€Šå¼€é”ã€‹ä¸­ï¼Œä¸šä¸»é»„å®è¦æ±‚å¼€é”å¸ˆå‚…æ—æ°¸å¥å¼€é”ï¼Œæ—æ°¸å¥è¦æ±‚é»„å®å‡ºç¤ºæœ‰æ•ˆè¯ä»¶ï¼Œå¯è¯ä»¶å°±åœ¨é”ç€çš„ç®±å­é‡Œå¤´ã€‚ æˆ‘è¿›è¡Œäº†æµ‹è¯•åå‘ç°ï¼Œåœ¨æˆæƒè¿‡ä¸€æ¬¡åï¼Œä¸‹æ¬¡æ‰‹æœºç”¨USBæ•°æ®çº¿è¿æ¥ç”µè„‘ï¼Œå†æ¬¡è¿›è¡Œè§£é”ï¼Œå³ä¾¿åŒå°ç”µè„‘ï¼Œä¹Ÿæ˜¯éœ€è¦å†æ¬¡æˆæƒçš„ã€‚è¿™å°±è¯´æ˜ï¼Œå³ä¾¿ä½ ç”¨ä½ çš„ç”µè„‘ç»è¿‡æ‰‹æœºæˆæƒè§£é”è¿‡ï¼Œè¿‡åæƒ³è¦åœ¨å¿˜è®°å¯†ç æ—¶ä½¿ç”¨ADBæ–¹å¼è§£é”ï¼Œä¹Ÿæ˜¯ä¸å¯èƒ½çš„ã€‚ æˆ‘è§‰å¾—è¿™æ˜¯é«˜ç‰ˆæœ¬çš„å®‰å“ç³»ç»Ÿï¼ˆeg. Android 4.2 Jelly Bean å®‰å“æœå†»è±†ï¼‰æ–°æœ‰çš„å®‰å…¨ç‰¹æ€§ï¼Œä½ç‰ˆæœ¬çš„Androidå¦‚å®‰å“2.3.8æ˜¯å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•è§£é”çš„ã€‚å› ä¸ºæˆ‘å®é™…æµ‹è¯•ï¼Œæˆ‘çš„å›ºä»¶ç‰ˆæœ¬ä¸ºå®‰å“2.3.8çš„ä¸‰æ˜ŸS5570ï¼ˆå·²ç»Rootï¼Œæ‰“å¼€USBè°ƒè¯•ï¼‰ï¼Œæ‰§è¡Œå‘½ä»¤rm gesture.keyï¼Œæ— éœ€æˆæƒï¼Œç›´æ¥å³å¯è§£é”ã€‚ç°åœ¨æˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œä½ç‰ˆæœ¬å®‰å“ç³»ç»Ÿå¦‚ Android2.3.8çš„æ‰‹æœºè§£é”å±å¹•é”å®šå¯†ç ï¼Œæ˜¯å¦çš„ç¡®å¿…é¡»Rootï¼Œè¿˜æ˜¯åªè¦æ‰“å¼€USBè°ƒè¯•å³å¯ï¼Ÿæˆ‘æ‰‹å¤´æ²¡æœ‰æ²¡Rootçš„Android2.3æ‰‹æœºï¼Œä¹Ÿæ‡’å¾—æŠ˜è…¾äº†ï¼Œå°±ä¸ç®¡å®ƒäº†ã€‚ è¿™æ ·çœ‹æ¥ï¼Œé«˜ç‰ˆæœ¬çš„å®‰å“ç³»ç»Ÿä¹Ÿå°±ä¸å­˜åœ¨è¢«éæ‰‹æœºæ‰€æœ‰è€…æ¶æ„è§£é”çš„BUGäº†ã€‚4. é¢˜å¤–è¯ï¼ˆä»Šå¹´å¥½ä¸œè¥¿éƒ½æŒ‚äº†ï¼‰æ”¶è´¹éŸ³ä¹ç¥å™¨å®˜ç½‘ï¼ŒæœåŠ¡å™¨æ¥å£å¹³å°AnyListen éŸ³ä¹é—´è°ä¸ºwindow PCç‰ˆï¼ŒéŸ³ä¹åŠ©æ‰‹Androidç‰ˆï¼ŒShelherå¾®åšåˆ†äº«å‡ºæ¥3.3ç‰ˆæºç ç™¾åº¦äº‘ â€‹â€‹â€‹â€‹å¯†ç griaï¼å°´å°¬çš„æ˜¯æœ‹å‹äº‘å…æµé‡ä¹Ÿä¸å¹²äº†ï¼","tags":[]},{"title":"SpiderWebMagic","date":"2017-01-30T12:50:27.000Z","path":"2017/01/30/SpiderWebMagic/","text":"WebMagicçˆ¬è™«æ¡†æ¶â€“äº¬ä¸œå›¾ä¹¦@(çˆ¬è™«)[æ¡†æ¶|çˆ¬è™«|Demoæ€»ç»“] WebMagic!é¡¹ç›®ä»£ç åˆ†ä¸ºæ ¸å¿ƒ(webmagic-core)å’Œæ‰©å±•(webmagic-extension)ä¸¤éƒ¨åˆ†(jaråŒ…)ã€‚Downloaderã€PageProcessorã€Schedulerã€Pipelineè¿™å››å¤§ç»„ä»¶å¯¹åº”çˆ¬è™«ç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸‹è½½ã€å¤„ç†ã€ç®¡ç†å’ŒæŒä¹…åŒ–ç­‰åŠŸèƒ½ã€‚ åç§° åŠŸèƒ½ Downloader åŸºç¡€ã€‚åˆ©ç”¨httpClientä½œä¸ºä¸‹è½½å·¥å…·ï¼Œä¸‹è½½é¡µé¢å†…å®¹ä¾¿äºåç»­å¤„ç†è§£æ; Page ç½‘é¡µå†…å®¹å¯¹è±¡ã€‚ æŒ‡æ ¹æ®urlä¸‹è½½åˆ°çš„é¡µé¢å†…å®¹ï¼ŒåŒ…æ‹¬é¡µé¢domå…ƒç´ ï¼Œcssæ ·å¼ï¼Œjavascriptç­‰; Pageprocess çˆ¬è™«çš„æ ¸å¿ƒã€‚ è´Ÿè´£è§£æé¡µé¢ï¼ŒæŠ½å–æœ‰ç”¨ä¿¡æ¯ï¼Œå¯é‡‡ç”¨css(),$(),xpath()æ–¹æ³•å¯¹ç‰¹å®šé¡µé¢å…ƒç´ è¿›è¡ŒæŠ½å–; Site ç½‘ç«™è®¾ç½®ã€‚è®¾ç½®ç½‘ç«™domainï¼Œcookies,header,é‡è¯•æ¬¡æ•°,è®¿é—®é—´éš”æ—¶é—´ç­‰; Scheduler æŠ“å–é¡µé¢é˜Ÿåˆ—ã€‚ ç®¡ç†å¾…æŠ“å–çš„URLï¼Œä»¥åŠä¸€äº›å»é‡çš„å·¥ä½œï¼Œå°†ç›®æ ‡urlå†…å®¹pushåˆ°æŠ“å–é˜Ÿåˆ—ä¸­; Pipeline è¾“å‡ºï¼Œæ”¶å°¾ã€‚ è´Ÿè´£æŠ½å–ç»“æœçš„å¤„ç†ï¼ŒåŒ…æ‹¬è®¡ç®—ã€æŒä¹…åŒ–åˆ°æ–‡ä»¶ã€æ•°æ®åº“; Spider çˆ¬è™«çš„å…¥å£ç±» é‡‡ç”¨é“¾å¼è®¾è®¡ï¼Œé€šè¿‡å®ƒæ¥è®¾å®šå¤šçº¿ç¨‹ï¼Œé¡µé¢è§£æå™¨ï¼Œè°ƒåº¦ä»¥åŠè¾“å‡ºæ–¹å¼ç­‰ã€‚ WebMagicå®˜æ–¹é“¾æ¥ï¼š å®˜ç½‘ åŒ…å«å®˜æ–¹æ–‡æ¡£å’Œæºç ,ä»¥åŠç›¸åº”çš„å®ä¾‹ï¼› github ä»“åº“ä¿å­˜æœ€æ–°ç‰ˆæœ¬ï¼› oschinamayunç äº‘ åŒ…å«æ‰€æœ‰ç¼–è¯‘å¥½çš„ä¾èµ–åŒ…ï¼› çˆ¬å–äº¬ä¸œå›¾ä¹¦(https://book.jd.com/)åœ¨å•†å“åˆ—è¡¨ç½‘é¡µæŠ“å–å¦‚ä¸‹å•†å“ä¿¡æ¯ å•†å“åï¼šå•†å“åç§° å•†å“ç½‘é¡µï¼šæ˜¾ç¤ºå•†å“è¯¦ç»†ä¿¡æ¯çš„ç½‘é¡µåœ°å€ã€‚ å¸‚åœºä»·æ ¼ï¼šäº¬ä¸œç»™å‡ºçš„å¸‚é¢ä»·æ ¼ äº¬ä¸œä»·æ ¼ï¼šäº¬ä¸œçš„ä¼˜æƒ ä»·ã€‚ å…³äºajaxä»·æ ¼é“¾æ¥åœ°å€æ ¼å¼ï¼šhttp://p.3.cn/prices/mgets?skuIds=J_ + å•†å“IDï¼ŒæŠ“å–æ ¼å¼ä¸ºjsonã€‚ https://item.jd.com/12087016.html ï¼šå›¾ä¹¦è¯¦æƒ…é¡µï¼› http://p.3.cn/prices/mgets?skuIds=J_12087016 ï¼ˆä¾‹ï¼‰ä»·æ ¼ajaxè¯·æ±‚é“¾æ¥ï¼› [{â€œidâ€:â€J_12087016â€,â€pâ€:â€60.80â€,â€mâ€:â€90.00â€,â€opâ€:â€60.80â€}] æŠ“å–ç»“æœ id + äº¬ä¸œå®é™…ä»·æ ¼+å¸‚åœºä»·æ ¼ ä»£ç å—123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778import us.codecraft.webmagic.Page;import us.codecraft.webmagic.Site;import us.codecraft.webmagic.Spider;import us.codecraft.webmagic.processor.PageProcessor;import java.util.ArrayList;import java.util.List;public class JDPageProcesser implements PageProcessor &#123; private Site site = Site.me().setRetryTimes(3).setSleepTime(3000).setCharset(\"GBK\"); private static int size = 0;// å…±æŠ“å–åˆ°çš„å›¾ä¹¦æ•°é‡ //æŠ“å–å•†å“ä¿¡æ¯é›†åˆ private static List&lt;String&gt; name = new ArrayList&lt;String&gt;();//æ‰€æœ‰çš„ä¹¦å private static List&lt;String&gt; author = new ArrayList&lt;String&gt;();//æ‰€æœ‰çš„ä½œè€… private static List&lt;Double&gt; prices = new ArrayList&lt;Double&gt;();//æ‰€æœ‰çš„ä»·æ ¼ @Override public void process(Page page) &#123; //å›¾ä¹¦ä¸»é¡µ // https://item.jd.com/12004057.html if (!page.getUrl().regex(\"https://item.jd.com/\\\\d&#123;8&#125;.html\").match()&amp;!page.getUrl().regex(\"p.3.cn/prices/mgets\").match()) &#123; // ä¸»é¡µä¸­æ·»åŠ å•†å“è¯¦æƒ…é¡µåˆ°è®¡åˆ’url List&lt;String&gt; detail = page.getHtml().links().regex(\"//item.jd.com/\\\\d&#123;8&#125;.html\").replace(\"//\", \"https://\").all(); //æ§åˆ¶æŠ“å–å•†å“çš„æ•°é‡ if (detail.size()&gt;0) &#123; for (int i = 0; i &lt; 4; i++) &#123; String url = detail.get(i); System.out.println(\"url:\" + url.replace(\"https://item.jd.com\", \"\").replace(\"/\", \"http://p.3.cn/prices/mgets?skuIds=J_\").replace(\".html\", \"\")); //åˆ—é˜Ÿæ·»åŠ ä¸€æ¡è¯¦æƒ…é¡µåé¢è¿½åŠ ä¸€æ¡ä»·æ ¼ajaxé“¾æ¥ page.addTargetRequest(url); page.addTargetRequest(url.replace(\"https://item.jd.com\", \"\").replace(\"/\", \"http://p.3.cn/prices/mgets?skuIds=J_\").replace(\".html\", \"\")); &#125; &#125; &#125; if (page.getUrl().regex(\"https://item.jd.com/\\\\d&#123;8&#125;.html\").match()) &#123; // å•†å“è¯¦æƒ…é¡µ size++; name.add(page.getHtml().xpath(\"//div[@id=name]/h1/text()\").get());//æ·»åŠ ä¹¦å author.add(page.getHtml().xpath(\"//div[@id=p-author]/a/text()\").get());//æ·»åŠ ä½œè€… &#125; if (page.getUrl().regex(\"p.3.cn/prices/mgets\").match()) &#123; //ajaxå•†å“idå¯¹åº”ä»·æ ¼jsonæ¥å£ prices.add(Double.parseDouble(page.getHtml().replace(\"&amp;quot\", \"\").regex(\"p;:;.+;,;m\").regex(\"\\\\d+\\\\.\\\\d+\").get()));//æ·»åŠ ä»·æ ¼ &#125; &#125; @Override public Site getSite() &#123; return site; &#125; //è·å–æ‰€æœ‰ä¿¡æ¯å¯¼å…¥DAO,æŒä¹…åŒ–å±‚å¾…å®ç° private static void getAll() &#123; System.out.println(\"Size\" + name.size() + author.size() + prices.size()); for (int i = 0; i &lt; name.size(); i++) &#123; JDLog model = new JDLog(); model.setName(name.get(i)); model.setAuthor(author.get(i)); model.setPrices(prices.get(i)); System.out.println(\"ä¹¦å:\" + model.getName()); System.out.println(\"ä½œè€…:\" + model.getAuthor()); System.out.println(\"ä»·æ ¼:\" + model.getPrices()); &#125; &#125; public static void main(String[] args) &#123; long startTime, endTime; System.out.println(\"ã€çˆ¬è™«å¼€å§‹ã€‘è¯·è€å¿ƒç­‰å¾…ä¸€å¤§æ³¢æ•°æ®åˆ°ä½ ç¢—é‡Œæ¥...\"); startTime = System.currentTimeMillis(); // ä»äº¬ä¸œå›¾ä¹¦å¼€å§‹æŠ“ï¼Œå¼€å¯5ä¸ªçº¿ç¨‹ï¼Œå¯åŠ¨çˆ¬è™« Spider.create(new JDPageProcesser()).addUrl(\"https://book.jd.com/\").thread(3).run(); endTime = System.currentTimeMillis(); getAll(); System.out.println(\"ã€çˆ¬è™«ç»“æŸã€‘å…±æŠ“å–\" + size + \"æœ¬å›¾ä¹¦ï¼Œè€—æ—¶çº¦\" + ((endTime - startTime) / 1000) + \"ç§’ï¼Œå·²ä¿å­˜åˆ°æ•°æ®åº“ï¼Œè¯·æŸ¥æ”¶ï¼\"); &#125;&#125; ä»¥åå°†ä¼šåšæŒæ›´æ–°!åé¦ˆä¸å»ºè®® é‚®ç®±ï¼š&#x63;&#x61;&#x6f;&#99;&#x68;&#105;&#x6b;&#x61;&#105;&#x40;&#x71;&#113;&#x2e;&#99;&#111;&#x6d;","tags":[]},{"title":"My New Post","date":"2016-12-24T13:46:06.000Z","path":"2016/12/24/First Wirte/","text":"Markdownåˆæ¬¡ä½¿ç”¨Markdownæ˜¯ä¸€é—¨è½»é‡çº§è¯­æ³•,ä»…ä»…éœ€è¦5åˆ†é’Ÿä½ å°±èƒ½ææ‡‚! æœŸæœ«åˆ·jspä½œä¸šå¿ƒå¾— DAOå±‚å°è£…æˆå·¥å…·ç±» ï¼šæŒä¹…å±‚å¤„ç†ä¸šåŠ¡,å°½é‡æŠŠå˜åŒ–ä¸œè¥¿é‡‡ç”¨æ•°ç»„éå†,çº¦å®šæˆä¿—ç®€åŒ–æˆé…ç½®åŒ–å†™ï¼› ç™»é™†æ³¨å†Œæ¨¡å—é‡ç”¨ ï¼šå‰ç«¯æ ·å¼å˜åŒ–,ä½†å°½é‡ä¸è¦ä¿®æ”¹æäº¤å‚æ•°åç§°å’Œä¸ªæ•°ï¼› å•å…ƒæµ‹è¯•ç±» ï¼šä½¿ç”¨ junitæµ‹è¯•æ¡†æ¶æ£€æŸ¥é€»è¾‘æ˜¯å¦æœ‰è¯¯,æ–¹ä¾¿éƒ¨ç½²è°ƒè¯• ã€‚ ä»£ç å—1234567891011121314151617// æ‰§è¡Œæ›´æ–°æ“ä½œ----å¸¦é¢„ç¼–è¯‘å‚æ•°public int excuteUpdate(String sql, String[] params) &#123; int result = 0; try &#123; pstmt = getCon().prepareStatement(sql); for (int i = 0; i &lt; params.length; i++) &#123; pstmt.setString(i + 1, params[i]); &#125; result = pstmt.executeUpdate(); &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125; finally &#123; pstmtClose(); conClose(); &#125; return result;&#125; ##ä»¥åå°†ä¼šæŒç»­æ›´æ–°,é¢„å‘Š webmagic æ¡†æ¶çˆ¬è™«ä¸‹æ¬¡å‡º åé¦ˆä¸å»ºè®® é‚®ç®±ï¼š&#99;&#97;&#x6f;&#x63;&#x68;&#x69;&#107;&#x61;&#105;&#x40;&#113;&#x71;&#46;&#x63;&#x6f;&#109;","tags":[]}]